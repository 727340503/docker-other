function scanCollectCodeCtrl(a,b,c,d,e,f,g,h){b.form=g,b.form.topBar.showTopBar=!0,b.form.topBar.showMenuBtn=!1,b.form.topBar.topBarTitle=d.instant("scanTheCode"),b.form.bottomMenu=!1,b.form.topBar.showBackBtn=!1,b.expandcode=!1,b.form.topBar.showShareBtn=!1,b.form.topBar.showCloseBtn=!0,b.collectCode=b.form.collectCode;var i=!0;setTimeout(function(){generateQrCode(b.collectCode),JsBarcode("#barcode",b.collectCode,{fontSize:40,textPosition:"top",textMargin:10,width:4,height:80,displayValue:!0})},70),b.done=function(){c.path("main/stampsDetail")},b.done=function(){b.getCollectMsg()},b.clearCollectCodeStatus=function(){if(i){i=!1;var a=copyData(b.form.userInfo);a.collectCode=b.collectCode;var c=apiDomain+clearCollectCodeStatus;sendGAEvent(a.collectCode,"Sticker-Collect","collect",1),$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.$apply()})}})}},b.getCollectMsg=function(){var a=copyData(b.form.userInfo);a.collectCode=b.collectCode;var d=apiDomain+getUserCollectStampMsg;$.ajax({type:AJAX_TYPE,data:a,url:d,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.posData=a.result,b.posMessage=a.result.msg,b.showRefresh=!1,b.haveScan=!1,0==b.posData.isScan?(b.showRefresh=!0,b.haveScan=!1):1==b.posData.isScan&&(b.showRefresh=!1,b.haveScan=!0,0==b.posData.scanStatus?(b.posSuccess=!1,b.errorMsg=b.posMessage):1==b.posData.scanStatus&&(b.posSuccess=!0)),b.showSuccess=!0,b.closeThisDialog=function(){b.showSuccess=!1,i=!0,f(function(){c.path("main/stampsDetail")},60)},h(b,{templateUrl:"pages/common/JsBarcode128Dlg.html?rnd="+rndver,preCloseCallback:b.closeThisDialog}),b.$apply()})}})},b.gotoCoupon=function(){b.form.fromMyCoupon=!0,c.path("main/promotion")},b.$root.closePopup=function(){c.path("main/stampsDetail")},b.init=function(){b.clearCollectCodeStatus(),f(function(){b.form.isCouponManagement?$(".collectStamp").height($(".main-content").height()-99):$(".collectStamp").height($(".main-content").height()-55)})},b.init()}var ScanCollectCodeCtrl=["$filter","$scope","$location","$translate","$state","$timeout","form","shoppoDialog",scanCollectCodeCtrl];angular.module("shoppoweb").controller("ScanCollectCodeCtrl",ScanCollectCodeCtrl);