function reservationFormCtrl(a,b,c,d,e,f,g,h){b.form=f,b.form.topBar.showTopBar=!0,b.form.topBar.showMenuBtn=!1,f.topBar.showLogo=!1,b.form.topBar.topBarTitle=d.instant("Reservation"),b.form.topBar.showBackBtn=!0,b.form.topBar.lastPage="/main/giftDetailReserve",b.form.isFromGiftDetail?(b.firstName=b.form.userInfo.firstName,b.lastName=b.form.userInfo.lastName,b.userPhone=b.form.userInfo.phone):(b.firstName=b.form.reservationForm.firstName,b.lastName=b.form.reservationForm.lastName,b.userPhone=b.form.reservationForm.userPhone);var i=!0;b.merchantAreaList=[{areaInfo:""}],b.form.isFromGiftDetail&&(b.form.storeList=[{name:""}]),b.getMerchantAreaList=function(){var a=copyData(b.form.userInfo),c=apiDomain+listMerchantArea;$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.merchantAreaList=a.result,0==b.merchantAreaList.length&&(b.merchantAreaList=[{areaInfo:""}]),b.$apply()})}})},b.getStoreList=function(a){if(i){i=!1;var c=copyData(b.form.userInfo);c.mrechantAreaId=a;var d=apiDomain+listStore;$.ajax({type:AJAX_TYPE,data:c,url:d,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.form.storeList=a.result,0==b.form.storeList.length&&(b.form.storeList=[{name:""}]),i=!0,b.$apply()})}})}},b.$watch("userPhone",function(a,c){new RegExp("[0-9][0-9]*$").test(a)?b.userPhone=a:b.userPhone=c,""!=a&&a||(b.userPhone="")}),b.$on("onRepeatLast",function(a,c,d){if("district"==c.parent()[0].id){$("#district").mobiscroll().treelist({theme:"ios",display:"bottom",lang:"en_US",labels:["business"],onSelect:function(a,c){b.mVal=a,b.district=a;for(var d=0;d<b.merchantAreaList.length;d++)b.merchantAreaList[d].areaInfo==a&&(b.form.haveSelectAreaId=b.merchantAreaList[d].merchantAreaId,b.getStoreList(b.merchantAreaList[d].merchantAreaId));delete b.storeId,delete b.storeName,b.storePhone="",$("#store_dummy").attr("placeholder","Pick up​"),b.$apply()},onInit:function(a){b.form.isFromGiftDetail?$("#district_dummy").attr("placeholder","City"):(b.district=b.form.reservationForm.district,b.storeName=b.form.reservationForm.storeName,$("#district_dummy").val(b.district),$("#store_dummy").val(b.storeName),b.storePhone=b.form.reservationForm.storePhone)}})}if("phoneAreaCode"==c.parent()[0].id){$("#phoneAreaCode").mobiscroll().treelist({theme:"ios",display:"bottom",lang:"en_US",labels:["business"],onSelect:function(a,c){a=a.substr(a.indexOf("+"),a.length),$("#phoneAreaCode_dummy").val(a),a=a.replace("+","00"),b.phoneAreaCode=a,b.isSelectCode=!0},onInit:function(a){g(function(){b.form.isFromGiftDetail?b.form.userInfo.phoneAreaCode?(b.phoneAreaCode=b.form.userInfo.phoneAreaCode,$("#phoneAreaCode_dummy").val(phoneCodeFormat(b.form.userInfo.phoneAreaCode))):(b.phoneAreaCode=b.form.phoneAreaCode,$("#phoneAreaCode_dummy").val(phoneCodeFormat(b.form.phoneAreaCode))):(b.phoneAreaCode=b.form.reservationForm.phoneAreaCode,$("#phoneAreaCode_dummy").val(phoneCodeFormat(b.form.reservationForm.phoneAreaCode)))},100)}})}if("store"==c.parent()[0].id){$("#store").mobiscroll().treelist({theme:"ios",display:"bottom",lang:"en_US",labels:["business"],onSelect:function(a,c){b.storeName=a,i=!0;for(var d=0;d<b.form.storeList.length;d++)b.form.storeList[d].name==a&&(b.storePhone=b.form.storeList[d].phone);for(var d=0;d<b.form.storeList.length;d++)b.form.storeList[d].name==a&&(b.storeId=b.form.storeList[d].storeId);b.$apply()},onInit:function(a){$("#store_dummy").attr("placeholder","Pick up​"),$("#district_dummy").val(b.district),b.form.isFromGiftDetail||$("#store_dummy").val(b.storeName)}})}}),b.isSelectCode=!1,b.$root.gotoLastPage=function(){g(function(){c.path(b.form.topBar.lastPage)},200)},b.gotoConfirm=function(){i&&(i=!1,b.form.reservationForm.district=b.district,b.form.reservationForm.firstName=b.firstName,b.form.reservationForm.lastName=b.lastName,b.form.reservationForm.phoneAreaCode=phoneCodeFormat(b.phoneAreaCode),b.form.reservationForm.contactPhoneAreaCode=b.phoneAreaCode,b.form.reservationForm.userPhone=b.userPhone,b.storeId&&(b.form.reservationForm.storeId=b.storeId),b.form.reservationForm.storeName=b.storeName,b.form.reservationForm.storePhone=b.storePhone,g(function(){c.path("main/reservationConfirm")},200))},b.iconClick=function(a){$("#"+a+"_dummy").click()},b.init=function(){b.getMerchantAreaList(),$(".phoneNum").css("height","20px")},b.init()}var ReservationFormCtrl=["$filter","$scope","$location","$translate","$state","form","$timeout","shoppoDialog",reservationFormCtrl];angular.module("shoppoweb").controller("ReservationFormCtrl",ReservationFormCtrl);