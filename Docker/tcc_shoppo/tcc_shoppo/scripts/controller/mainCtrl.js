function mainCtrl(a,b,c,d,e){a.form=c,resistSession(c),!a.form.userInfo.userId&&localStorage.getItem("userInfo")&&(a.form.userInfo=angular.fromJson(localStorage.getItem("userInfo"))),a.$root.menuHightlight=function(a){if(window.location.href.indexOf(a)>=0)return"active-page"},a.qrCodeCallback=function(){alert("close")},goBack=function(){a.form.topBar.lastPage?e(function(){d.path(a.form.topBar.lastPage)},200):window.location="tcc://shoppo?func=exitApp"},pushNotify=function(c,d){a.form.pushMsg=c,a.closeThisDia=function(){},b(a,{templateUrl:"pages/common/iosPushDlg.html",preCloseCallback:a.closeThisDia})},iosPushNotify=function(c){a.form.pushMsg=c.pushMsg,a.closeThisDia=function(){},b(a,{templateUrl:"pages/common/iosPushDlg.html",preCloseCallback:a.closeThisDia})},a.form.pushNotification=function(b,c){try{a.pushData=JSON.parse(c)}catch(b){a.pushData=c}a.form.getPush=!0,b?1==a.pushData.type?d.path("main/user"):2==a.pushData.type?(a.form.campaignId=a.pushData.campaignId,a.form.stampCardId=a.pushData.stampCardId,a.form.stampPageTab=!0,d.path("main/stampsDetail")):3==a.pushData.type?(a.form.showFriendList=!0,d.path("main/user")):4==a.pushData.type&&5==a.pushData.pageRedirectType&&d.path("main/promotion"):1==a.pushData.type?d.path("main/login"):2==a.pushData.type?d.path("main/login"):3==a.pushData.type?d.path("main/login"):4==a.pushData.type&&d.path("main/promotion"),d.search("pushData","")},a.qrCodeEvent=function(c){a.a="abc",b(a,{templateUrl:"pages/common/warningDlg.html"}),generateQrCode("")};var f=!0;a.form.isSearch=!1;var g=$(window).height();a.$root.showMenu=function(){$(".menu").height(g-70),$(".menu-list").height(g-70),f?($(".menu").addClass("on"),$(".menu-list").css("overflow","auto"),$(".menu-list").css("transition","all 0.5s"),$(".menu-list").css("transform","translate(0, 0)"),f=!1):($(".menu").removeClass("on"),$(".menu-list").css("transition","all 0.5s"),$(".menu-list").css("transform","translate(-200px, 0)"),f=!0),a.$root.hideRecordList()},a.$root.hideMenu=function(){$(".menu").removeClass("on"),$(".menu-list").css("transition","all 0.5s"),$(".menu-list").css("transform","translate(-200px, 0)"),f=!0},a.$root.menuBtnEvent=function(b){b.indexOf("http")<0?d.path(b):(a.form.setLocalStorage(),window.location.href=b),$(".menu").removeClass("on"),$(".menu-list").css("transform","translate(-200px, 0)"),f=!0},a.$root.searchBtn=function(){$(".searchRecord").height(g-50),a.record="searchRecord",localStorage.getItem(a.record)?a.form.recordArray=JSON.parse(localStorage.getItem(a.record)):a.form.recordArray=[],a.form.topBar.showSearchBtn=!1,a.form.isSearch=!0,$(".searchRecord").addClass("on"),a.$root.hideMenu()},a.$root.submitSearchBtn=function(){if(a.form.searchText){for(var b=!0,c=0;c<a.form.recordArray.length;c++)a.form.searchText==a.form.recordArray[c].name&&(b=!1);b&&(a.form.recordArray.push({name:a.form.searchText}),a.form.recordArray.length>5&&a.form.recordArray.shift()),localStorage.setItem(a.record,JSON.stringify(a.form.recordArray)),a.form.topBar.showSearchBtn=!0,a.form.isSearch=!1,a.form.searchName=a.form.searchText,a.form.searchText="",$(".searchRecord").removeClass("on"),0==a.form.onChoose?a.form.defoSearchFn():d.path("/main/searchList")}},a.$root.clearRecord=function(){localStorage.setItem(a.record,""),a.form.recordArray=[]},a.$root.hideRecordList=function(){$(".searchRecord").removeClass("on")},a.$root.clearSearchText=function(){a.form.searchText=""},a.$root.setInput=function(b){a.form.searchText=b},a.$root.showSearchRecord=function(){$(".searchRecord").addClass("on"),a.$root.hideMenu()};var h=!0;a.$root.showSideMenu=function(){$(".sideMenu").height(g-90),$(".sideMenu-list").height(g-90),h?($(".sideMenu").addClass("on"),$(".sideMenu-list").css("overflow","auto"),$(".sideMenu-list").css("transition","all 0.5s"),$(".sideMenu-list").css("transform","translate(0, 0)"),h=!1):($(".sideMenu").removeClass("on"),$(".sideMenu-list").css("transition","all 0.5s"),$(".sideMenu-list").css("transform","translate(-200px, 0)"),h=!0)},a.$root.hideSideMenu=function(){$(".sideMenu").removeClass("on"),$(".sideMenu-list").css("transition","all 0.5s"),$(".sideMenu-list").css("transform","translate(-200px, 0)"),h=!0},a.form.lang="en",a.$root.gotoAddfriend=function(){0==a.form.userInfo.userType?(a.form.isFromUser=!0,d.path("main/registration")):(a.form.isFromUser=!0,a.form.isFromStampsDetail=!1,d.path("main/addFriends"))},a.form.merchantCode=merchantCode,a.form.getMerchantDetail=function(b){var c={};c.merchantCode=a.form.merchantCode;var e=apiDomain+getMerchantDetail;$.ajax({type:AJAX_TYPE,data:c,url:e,context:document.body,success:function(c){apiResultsProcessingFun(c,function(){if(c.result){a.form.merchantId=c.result.merchantId,a.form.langType=c.result.langType,a.form.reservationType=c.result.reservationType,a.form.hoursFormat=c.result.hoursFormat,a.form.phoneAreaCode=c.result.phoneDistrictCode,a.form.isCouponManagement=c.result.isCouponManagement,a.form.mapType=c.result.mapType,c.result.loginMethod.indexOf("1")>=0&&(a.form.emailMethod=!0),c.result.loginMethod.indexOf("2")>=0&&(a.form.facebookMethod=!0),a.form.currencyFontCode=c.result.currencyFontCode,a.form.dateFormat=c.result.dateFormat,localStorage.getItem("userInfo")&&(a.user=angular.fromJson(localStorage.getItem("userInfo")),a.user.merchantId!=a.form.merchantId?(a.form.userInfo={},localStorage.removeItem("userInfo")):(a.form.userInfo=a.user,a.form.userInfo.merchantId=a.form.merchantId)),a.form.userInfo.merchantId=a.form.merchantId;for(var e=0;e<a.form.langType.length;e++)1==a.form.langType[e].isDefault&&(a.form.langCode=a.form.langType[e].langCode);a.form.userInfo.langCode||(a.form.userInfo.langCode=a.form.langCode),b&&b(),a.$apply()}else d.path("main/error")})}})},a.form.getDeviceToken=function(){inviteCallback=function(b){a.deviceToken=JSON.parse(b).result,"Android"==deviceDetection.device?a.deviceType=2:a.deviceType=1,a.deviceToken&&a.registerDeviceTokenEvent()},1==a.form.isInApp&&(window.location="tcc://shoppo?func=deviceToken&callback=inviteCallback")},a.registerDeviceTokenEvent=function(){var b=copyData(a.form.userInfo);b.status=1,b.deviceToken=a.deviceToken,b.deviceType=a.deviceType;var c=apiDomain+registerDeviceToken;$.ajax({type:AJAX_TYPE,url:c,context:document.body,data:b,success:function(b){apiResultsProcessingFun(b,function(){a.$apply()})}})},a.form.getPofile=function(b){var c=copyData(a.form.userInfo),d=apiDomain+getUserPofile;$.ajax({type:AJAX_TYPE,url:d,context:document.body,data:c,success:function(c){apiResultsProcessingFun(c,function(){a.form.userInfo=$.extend(a.form.userInfo,c.result),localStorage.setItem("userInfo",angular.toJson(a.form.userInfo)),b&&b(),a.$apply()})}})},a.form.getUserPofile=function(b){var c=copyData(a.form.userInfo),d=apiDomain+getUserPofile;$.ajax({type:AJAX_TYPE,url:d,context:document.body,data:c,success:function(c){apiResultsProcessingFun(c,function(){a.form.userInfo=$.extend(a.form.userInfo,c.result),a.form.userInfo.userName&&a.form.userInfo.firstName&&a.form.userInfo.lastName&&a.form.userInfo.contactEmail?(a.gotoLanding(),localStorage.setItem("userInfo",angular.toJson(a.form.userInfo))):(3==b?(a.form.userInfo.userName="",a.form.userInfo.firstName=a.form.facebookInfo.first_name,a.form.userInfo.lastName=a.form.facebookInfo.last_name,a.form.userInfo.contactEmail=a.form.facebookInfo.email,a.form.registerType=3):1==b&&(a.form.userInfo.userName="",a.form.registerType=1,a.form.userInfo.contactEmail=a.form.userInfo.email),a.gotoSetProFile()),a.$apply()})}})},a.gotoLanding=function(){e(function(){d.path("/main/landing")},200)},a.gotoSetProFile=function(){e(function(){d.path("/main/setProfile")},200)},a.form.appName=appName,a.form.shareEvent=function(b,c,d,e){var f=copyData(a.form.userInfo);f.title=b,f.image=c,f.description=d;var g=apiDomain+saveShareData;$.ajax({type:AJAX_TYPE,data:f,url:g,context:document.body,success:function(c){apiResultsProcessingFun(c,function(){1==a.form.isInApp&&(window.location="addFriend"==e?"tcc://shoppo?func=share&title="+b+"&msg="+d+"&url="+encodeURIComponent(c.result.shareDownloadPageUrl+"&name="+a.form.userInfo.userName):"tcc://shoppo?func=share&title="+b+"&msg="+d+"&url="+encodeURIComponent(c.result.shareDownloadPageUrl)),a.$apply()})}})}}function warningDlgCtrl(a){a.msg=$("#warningMsg").val()}function qrCodeDlgCtrl(a,b){a.b="c",generateQrCode($("#qrCodeVal").val())}var MainCtrl=["$scope","shoppoDialog","form","$location","$timeout",mainCtrl];angular.module("shoppoweb").controller("MainCtrl",MainCtrl);var WarningDlgCtrl=["$scope",warningDlgCtrl],QrCodeDlgCtrl=["$scope","$controller",qrCodeDlgCtrl];