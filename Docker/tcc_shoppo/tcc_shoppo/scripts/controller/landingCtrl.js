function landingCtrl(a,b,c,d,e,f,g){b.form=g,b.form.topBar.showTopBar=!0,b.form.topBar.showMenuBtn=!1,b.form.menuMerchantList=!0,b.form.topBar.showLogo=!0,b.form.bottomMenu=!0,b.form.topBar.lastPage="",b.form.fromHomePage=!0,b.topGroup=[],b.othergroups=[],b.form.isInApp=c.search().inApp,localStorage.getItem("isCheckMobile")&&(localStorage.removeItem("isCheckMobile"),localStorage.removeItem("userInfo"),b.form.userInfo={},b.form.facebookInfo=null,b.form.getMerchantDetail(b.register)),b.openLink=function(a,c,d,e){a&&(sendGAEvent(a,d+"-"+e,"click",1),1==c?1==b.form.isInApp?window.location="tcc://shoppo?func=inappUrl&url="+a:(b.form.webUrl=a,$("#iframed").empty(),$("#iframed").append("<i class='icon-close' onclick='back()'></i><iframe class='game-iframe' src='"+a+"'scrolling='no' frameborder='0' sandbox='allow-forms allow-scripts'></iframe>"),$("#iframed").css("display","block"),$("#home").css("display","none")):1==b.form.isInApp&&(window.location="tcc://shoppo?func=nativeUrl&url="+a))},b.getListHomePages=function(){var a=copyData(b.form.userInfo),c=apiDomain+listHomePage;$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.homePage=JSON.parse(a.result.homePage),b.records=a.result.records;for(var c=0;c<b.records.length;c++)for(var d=0;d<b.homePage.length;d++)for(var e=0;e<b.homePage[d].length;e++)b.homePage[d][e].refId==b.records[c].refId&&b.homePage[d][e].type==b.records[c].type&&(b.homePage[d][e]=b.records[c]);b.topGroup=b.homePage.splice(0,1),b.topGroup=b.topGroup[0],b.newestCampain=b.homePage.splice(b.homePage.length-1,1),b.newestCampain=b.newestCampain[0][0],b.othergroups=b.homePage,b.newestCampain&&b.getCampaignDetail(),b.$apply(),b.flexslider(),fixHeight()})}})},b.getCampaignDetail=function(){var a=copyData(b.form.userInfo);a.campaignId=b.newestCampain.refId;var c=apiDomain+getCampaignDetail;$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){if(b.newestCampainInfo=a.result,b.newestCampainInfo.bgImg?(b.newestCampainBgImg="url("+b.newestCampainInfo.bgImg+")",$("#newestCampain").css("background-image",b.newestCampainBgImg)):b.newestCampainInfo.bgColor?$("#newestCampain").css("background-color",b.newestCampainInfo.bgColor):$("#newestCampain").css("background-image","url(images/stamp_collection_default.png)"),b.form.stampCardId=b.newestCampainInfo.stampCardId,b.form.stampsCardCoverImg=b.newestCampainInfo.coverImg,b.collStartTime=getTimeStamp(b.newestCampainInfo.collStartTime),b.collEndTime=getTimeStamp(b.newestCampainInfo.collEndTime),b.redeemStartTime=getTimeStamp(b.newestCampainInfo.redeemStartTime),b.redeemEndTime=getTimeStamp(b.newestCampainInfo.redeemEndTime),b.startTime=getTimeStamp(b.newestCampainInfo.startTime),b.endTime=getTimeStamp(b.newestCampainInfo.endTime),b.currDate=getTimeStamp(b.newestCampainInfo.currDate),b.endTime<b.currDate?b.expired=!0:b.expired=!1,b.currDate<b.startTime?b.pending=!0:b.pending=!1,b.collStartTime<=b.currDate&&b.currDate<=b.collEndTime?b.canCollect=!0:b.canCollect=!1,b.redeemStartTime<=b.currDate&&b.currDate<=b.redeemEndTime?b.canRedeem=!0:b.canRedeem=!1,0!=b.form.userInfo.userType)b.getUserStampCard();else{b.stampsCardInfo={},b.stampsCardInfo.collectStampQty=0,b.setStamp(b.stampsCardInfo.collectStampQty);for(var c=0;c<b.stamps.length;c++)b.stamps[c].num<=0&&(b.stamps[c].stampImg=b.userStamps[b.stamps[c].num-1].stampImg)}b.$apply()})}})},b.getUserStampCard=function(){var a=copyData(b.form.userInfo);a.stampCardId=b.form.stampCardId,a.campaignId=b.newestCampainInfo.campaignId;var c=apiDomain+getUserStampCard;$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.stampsCardInfo=a.result,b.setStamp(b.stampsCardInfo.collectStampQty),b.getListUserStamp(),b.$apply()})}})},b.getListUserStamp=function(){var a=copyData(b.form.userInfo);a.username=a.userName,a.userStampCardId=b.stampsCardInfo.id;var c=apiDomain+listUserStamp;$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.userStamps=a.result;for(var c=0;c<b.stamps.length;c++)b.stamps[c].num<=b.stampsCardInfo.collectStampQty&&(b.stamps[c].stampImg=b.userStamps[b.stamps[c].num-1].stampImg);b.$apply()})}})},b.register=function(){var a={};a.langCode=b.form.langCode,a.merchantId=b.form.merchantId,a.registerType=0;var d=apiDomain+getTempUser;$.ajax({type:AJAX_TYPE,data:a,url:d,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.form.userInfo=a.result,b.form.userInfo.userName="",b.form.userInfo.langCode=b.form.langCode,localStorage.setItem("userInfo",angular.toJson(b.form.userInfo)),b.getListHomePages(),c.search().name&&(c.path("main/registration"),c.search("name","")),c.search().pushData&&b.pushNotification(!1),b.$apply()})}})},b.gotoStampsDetail=function(){b.form.campaignId=b.newestCampain.refId,b.form.campainTerms=b.newestCampainInfo.terms,b.form.stampPageTab=!0,c.path("main/stampsDetail"),sendGAEvent(b.form.campaignId,"Home-Collect","click",1);var a=copyData(b.form.userInfo);a.campaignId=b.newestCampain.refId;var d=apiDomain+getCampaignDetail;$.ajax({type:AJAX_TYPE,data:a,url:d,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.newestCampainInfo=a.result,b.collStartTime=getTimeStamp(b.newestCampainInfo.collStartTime),b.collEndTime=getTimeStamp(b.newestCampainInfo.collEndTime),b.redeemStartTime=getTimeStamp(b.newestCampainInfo.redeemStartTime),b.redeemEndTime=getTimeStamp(b.newestCampainInfo.redeemEndTime),b.startTime=getTimeStamp(b.newestCampainInfo.startTime),b.endTime=getTimeStamp(b.newestCampainInfo.endTime),b.currDate=getTimeStamp(b.newestCampainInfo.currDate),b.endTime<b.currDate?c.path("main/stampsDetailExpired"):c.path("main/stampsDetail")})}})},b.gotoStampsDetailRedeem=function(){b.form.campaignId=b.newestCampain.refId,b.form.campainTerms=b.newestCampainInfo.terms,b.form.stampPageTab=!1,sendGAEvent(b.form.campaignId,"Home-Redeem","click",1),c.path("main/stampsDetail")};var h=!0;b.flexslider=function(){h=1!=b.topGroup.length,$(".flexslider").flexslider({animation:"slide",directionNav:!1,slideshow:h,slideshowSpeed:5e3,prevText:"",nextText:"",controlNav:!0,animation:"slide",animationLoop:h,before:function(a){a.pause(),a.play()}}),$(".flexslider").removeClass("hide"),$(".flexslider-card").flexslider({animation:"slide",controlNav:!1,directionNav:!0,slideshow:!0,prevText:"",nextText:"",after:function(a){var c=a.currentSlide;b.page=c+1,b.$apply()},before:function(a){a.pause(),a.play()}}),$(".flex-prev").addClass("hide"),$(".flex-next").addClass("hide")},b.preClick=function(){$(".flex-prev").click()},b.nextClick=function(){$(".flex-next").click()},b.setStamp=function(a){if(b.stampNum=a,b.stamps={},b.stamps.length=15,0==a){b.stampPage=0;for(var c=1;c<=b.stamps.length;c++)b.stamps[c-1]={},b.stamps[c-1].num=c+b.stampPage}else{b.stampPage=15*Math.ceil(a/15)-14;for(var c=1;c<=b.stamps.length;c++)b.stamps[c-1]={},b.stamps[c-1].num=b.stampPage,b.stampPage++}setTimeout(function(){$(".stampsModule").height($(".stampsModule").width()),$(".stampsModule img").width($(".stampsModule").width()+2);for(var a=$(".stampsModule").find("img"),b=0;b<=a.length;b++){var c=Math.round(60*Math.random()-30);$(a[b]).css("transform","rotate("+c+"deg)")}},60)},b.startNow=function(){b.form.isFromLandingPage=!0,c.path("main/registration")},b.init=function(){if(!localStorage.getItem("showedTutorial"))return b.showedTutorial=!0,b.form.topBar.showTopBar=!1,b.form.bottomMenu=!1,localStorage.setItem("showedTutorial",!0),void fixHeight();b.showedTutorial=!1,localStorage.getItem("userInfo")?0!=b.form.userInfo.userType?b.form.getPofile(function(){return 0==b.form.userInfo.userType||b.form.userInfo.userName&&b.form.userInfo.firstName&&b.form.userInfo.lastName&&b.form.userInfo.contactEmail?0!=b.form.userInfo.userType&&0==b.form.userInfo.isPhoneValidation?(b.form.fromLanding=!0,void(localStorage.getItem("isCheckMobile")||(localStorage.setItem("isCheckMobile",!0),c.path("main/resetMobile")))):(b.form.userInfo=angular.fromJson(localStorage.getItem("userInfo")),void(b.form.userInfo.userName&&b.form.userInfo.firstName&&b.form.userInfo.lastName&&b.form.userInfo.contactEmail?(b.getListHomePages(),c.search().name&&(b.form.friendName=c.search().name,c.path("main/addFriends"),c.search("name","")),c.search().pushData&&!b.form.getPush&&b.form.pushNotification(!0,c.search().pushData)):b.register())):void c.path("main/setProfile")}):b.getListHomePages():b.register()},b.form.getMerchantDetail(b.init),fixHeight();var i=!0;b.flexsliderEvent=function(){i&&($(".flexsliderTutorial").flexslider({animation:"slide",directionNav:!1,slideshow:!1,prevText:"",nextText:"",controlNav:!0,animation:"slide",animationLoop:!1,before:function(a){}}),i=!1)},b.skipEvent=function(){b.showedTutorial=!1,b.form.topBar.showTopBar=!0,b.form.bottomMenu=!0,fixHeight(),b.init()},b.registerEvent=function(){c.path("main/registration")}}var LandingCtrl=["$filter","$scope","$location","$translate","$state","$timeout","form",landingCtrl];angular.module("shoppoweb").controller("LandingCtrl",LandingCtrl);