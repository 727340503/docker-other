function reservationConfirmCtrl(a,b,c,d,e,f,g,h){b.form=f,b.form.topBar.showTopBar=!0,b.form.topBar.showMenuBtn=!1,f.topBar.showLogo=!1,b.form.topBar.topBarTitle=d.instant("Reservation"),b.form.topBar.showBackBtn=!0,b.form.topBar.lastPage="/main/reservationForm",b.form.isFromGiftDetail=!1;var i=!0,j=!0;b.getGiftDetail=function(){var a=copyData(b.form.userInfo);a.giftId=b.form.gift.giftId,a.campaignId=b.form.campaignId;var c=apiDomain+getGiftDetail;$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.giftDetail=a.result,b.exchangeRule=b.giftDetail.exchangeTypeList,b.getUserStampCard(),b.$apply()})}})},b.getUserStampCard=function(){var a=copyData(b.form.userInfo);a.stampCardId=b.form.stampCardId,a.campaignId=b.form.campaignId;var c=apiDomain+getUserStampCard;$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.stampsCardInfo=a.result,b.$apply()})}})},b.saveUserReservation=function(){if(i){i=!1;var a=copyData(b.form.userInfo);a.userStampCardId=b.stampsCardInfo.id,a.storeId=b.form.reservationForm.storeId,a.campaignGiftMapId=b.giftDetail.id,a.campaignGiftExchangeTypeId=b.form.reservationForm.exchangeType.campaignGiftExchangeTypeId,a.firstName=b.form.reservationForm.firstName,a.lastName=b.form.reservationForm.lastName,a.contactPhoneAreaCode=b.form.reservationForm.contactPhoneAreaCode,a.contactPhone=b.form.reservationForm.userPhone;var c=apiDomain+saveUserReservation;$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.form.reservationCode=a.result.reservationCode,sendGAEvent(b.form.gift.name+" "+b.form.reservationForm.exchangeType.stampQty,"RewardDetail-Reward","Reserve",1),1==b.form.reservationForm.exchangeType.type||1==b.form.reservationType?b.gotoComplete():b.clearUserReservationCodeStatus(),b.$apply()})}})}},b.clearUserReservationCodeStatus=function(){var a=copyData(b.form.userInfo);a.reservationCode=b.form.reservationCode;var c=apiDomain+clearUserReservationCodeStatus;$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.redeem(),b.$apply()})}})},b.redeem=function(){b.qrCode=b.form.reservationCode,b.barCode=b.form.reservationCode,b.reservationWithCash=!0,b.showCode=!0,b.showSuccess=!1,b.showError=!1,b.showRefresh=!1,b.closeThisDialog=function(){b.reservationWithCash=!1,b.showCode=!1,b.showSuccess=!1,b.showError=!1,b.showRefresh=!1,b.qrCode="",b.barCode="",i=!0,j&&b.gotoStampDetail()},h(b,{templateUrl:"pages/common/JsBarcode128Dlg.html?rnd="+rndver,preCloseCallback:b.closeThisDialog})},b.getUserReservationMsg=function(){var a=copyData(b.form.userInfo);a.reservationCode=b.form.reservationCode;var c=apiDomain+getUserReservationMsg;$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.userReservationMsg=a.result,b.showCode=!1,0==b.userReservationMsg.isScan?(b.showError=!1,b.showRefresh=!0):(b.showRefresh=!1,0==b.userReservationMsg.scanStatus?(b.errorMsg=a.result.msg,b.showError=!0):(j=!1,b.showError=!1,b.gotoComplete())),b.$apply()})}})},b.$root.gotoLastPage=function(){c.path(b.form.topBar.lastPage)},b.gotoComplete=function(){c.path("main/reservationComplete")},b.gotoStampDetail=function(){g(function(){c.path("main/stampsDetail")},200)},b.init=function(){b.getGiftDetail()},b.init()}var ReservationConfirmCtrl=["$filter","$scope","$location","$translate","$state","form","$timeout","shoppoDialog",reservationConfirmCtrl];angular.module("shoppoweb").controller("ReservationConfirmCtrl",ReservationConfirmCtrl);