function registrationCtrl(a,b,c,d,e,f,g,h){b.form=f,b.form.topBar.showTopBar=!0,b.form.topBar.topBarTitle=d.instant("Registration"),b.form.topBar.showBackBtn=!0,b.form.topBar.showLoginBtn=!0,b.form.bottomMenu=!1,b.form.fromRegistration=!1,b.page=1,b.form.phone?b.phone=b.form.phone:b.phone="",b.form.userPhoneAreaCode?b.phoneAreaCode=b.form.userPhoneAreaCode:b.phoneAreaCode="",b.form.isFromLandingPage?b.form.topBar.lastPage="/main/landing":b.form.isFromStampCard?b.form.topBar.lastPage="/main/stampsCard":b.form.isFromReservation?b.form.topBar.lastPage="/main/user":b.form.isFromMore?b.form.topBar.lastPage="/main/more":b.form.isFromUser?b.form.topBar.lastPage="/main/user":b.form.topBar.lastPage="/main/landing",b.overResendTimes=!0,b.$on("onRepeatLast",function(a,c,d){$("#phoneAreaCode").mobiscroll().treelist({theme:"ios",display:"bottom",lang:"en_US",labels:["business"],onSelect:function(a,c){a=a.substr(a.indexOf("+"),a.length),$("#phoneAreaCode_dummy").val(a),a=a.replace("+","00"),b.phoneAreaCode=a}});g(function(){b.phoneAreaCode||(b.phoneAreaCode=phoneCodeFormat(b.form.phoneAreaCode)),$("#phoneAreaCode_dummy").val(phoneCodeFormat(b.phoneAreaCode))},200)}),b.preRegister=function(){g(function(){$(".main-content").scrollTop(0),b.form.topBar.topBarTitle=d.instant("verificationCode"),b.page=2,g(function(){$(".verifyCode").focus()}),b.form.topBar.showBackBtn=!1,b.form.topBar.showCloseBtn=!0,b.form.topBar.showLoginBtn=!1},200)},b.$root.closePopup=function(){b.overResendTimes=!0,$(".main-content").scrollTop(0),i&&clearInterval(i),b.form.topBar.topBarTitle=d.instant("Registration"),b.page=1,b.form.topBar.showBackBtn=!0,b.form.topBar.showCloseBtn=!1,b.form.topBar.showLoginBtn=!0},b.verfiedSuccess=function(){$(".main-content").scrollTop(0),b.form.topBar.topBarTitle=d.instant("Verification successful"),b.page=3,b.form.topBar.showBackBtn=!1,b.form.topBar.showCloseBtn=!1,b.form.topBar.showLoginBtn=!1},b.$watch("phone",function(a,c){new RegExp("^[0-9]*$").test(a)?b.phone=a:b.phone=c,""!=a&&a||(b.phone="")}),jQuery.validator.addMethod("checkSpace",function(a,b,c){return 0!=a.replace(/\s/g,"").length},$.validator.format("This field is required.")),$("#registraion").validate({errorPlacement:function(a,b){b.after(a)},rules:{},messages:{},submitHandler:function(a){}}),b.submitEvent=function(){$("#registraion").submit()},b.$root.gotoLastPage=function(){b.form.isFromLandingPage=!1,b.form.isFromStampCard=!1,b.form.isFromReservation=!1,b.form.isFromMore=!1,b.form.isFromUser=!1,g(function(){c.path(b.form.topBar.lastPage)},200)},b.$root.gotoLogin=function(){b.form.isFromRegister=!0,b.form.phone=b.phone,b.form.userPhoneAreaCode=b.phoneAreaCode,g(function(){c.path("main/login")},200)},b.agreeTC=!1,b.form.isMarketingInfo=0,b.agreeTCFn=function(){b.agreeTC?b.agreeTC=!1:b.agreeTC=!0},b.isMarketingInfoFn=function(){1==b.form.isMarketingInfo?b.form.isMarketingInfo=0:b.form.isMarketingInfo=1},b.facebookIsReady=!0,b.facebookLogin=function(){getfaceBookUserInfo=function(a){b.form.facebookInfo=JSON.parse(a.result),b.checkFbEvent(3)},1==b.form.isInApp&&(window.location.href="tcc://shoppo?func=facebookLogin&callback=getfaceBookUserInfo")},b.gotoPrivacy=function(){b.form.fromRegistration=!0,b.form.phone=b.phone,b.form.userPhoneAreaCode=b.phoneAreaCode,"en_US"==d.use()&&c.path("/main/privacy_en_US")},b.gotoTAndC=function(){b.form.fromRegistration=!0,b.form.phone=b.phone,b.form.userPhoneAreaCode=b.phoneAreaCode,"en_US"==d.use()&&c.path("/main/tAndC_en_US")},b.gotoLanding=function(){g(function(){c.path("/main/landing")},200)},b.gotoSetProFile=function(){g(function(){c.path("/main/setProfile")},200)},b.gotoEmailRegister=function(){b.form.fromRegistration=!0,b.form.phone=b.phone,b.form.userPhoneAreaCode=b.phoneAreaCode,g(function(){c.path("/main/registrationEmail")},200)},b.sendSmsEvent=function(a){$(".phoneInput").blur(),g(function(){var a=copyData(b.form.userInfo);a.phoneAreaCode=b.phoneAreaCode.replace("+","00"),a.phone=b.phone,a.verifyType=1;var c=apiDomain+sendSms;$.ajax({type:AJAX_TYPE,url:c,context:document.body,data:a,success:function(a){apiResultsProcessingFun(a,function(){10484==a.errorCode?angular.element("body").scope().$root.warningDlg({msg:a.errorMessage}):(b.preRegister(),b.timeEvent()),b.$apply()})}})},200)},b.time=0;var i;b.timeEvent=function(){b.time=60,i&&clearInterval(i),i=setInterval(function(){b.time--,b.time<=0&&(clearInterval(i),b.time=0),b.$apply()},1e3)},b.resendSmsEvent=function(){if(0==b.time){var a=copyData(b.form.userInfo);a.phoneAreaCode=b.phoneAreaCode.replace("+","00"),a.phone=b.phone,a.verifyType=1;var c=apiDomain+resendSms;$.ajax({type:AJAX_TYPE,url:c,context:document.body,data:a,success:function(a){apiResultsProcessingFun(a,function(){10484==a.errorCode?(b.overResendTimes=!1,angular.element("body").scope().$root.warningDlg({msg:a.errorMessage}),b.$apply()):(b.overResendTimes=!0,b.timeEvent()),b.$apply()})}})}},b.verifySmsEvent=function(){b.verifyCode&&g(function(){var a=copyData(b.form.userInfo);a.phoneAreaCode=b.phoneAreaCode.replace("+","00"),a.phone=b.phone,a.verifyType=1,a.verifyCode=b.verifyCode;var c=apiDomain+verifySms;$.ajax({type:AJAX_TYPE,url:c,context:document.body,data:a,success:function(a){apiResultsProcessingFun(a,function(){b.form.userInfo.phoneAreaCode=b.phoneAreaCode.replace("+","00"),b.form.userInfo.phone=b.phone,b.form.registerType=2,b.checkPhone=!0,b.verfiedSuccess(),b.$apply()})}})},200)},b.checkFbEvent=function(){var a=copyData(b.form.userInfo);a.snsId=b.form.facebookInfo.id,a.snsType=1,a.snsAccessToken=b.form.facebookInfo.token;var c=apiDomain+checkIsExistFbAccount;$.ajax({type:AJAX_TYPE,url:c,context:document.body,data:a,success:function(a){apiResultsProcessingFun(a,function(){1==a.result?b.loginEvent(3):(b.form.registerType=3,b.gotoSetProFile()),b.$apply()})}})},b.loginEvent=function(a){var c=copyData(b.form.userInfo);c.loginType=a,c.snsId=b.form.facebookInfo.id,c.snsType=1,c.snsAccessToken=b.form.facebookInfo.token;var d=apiDomain+newLogin;$.ajax({type:AJAX_TYPE,url:d,context:document.body,data:c,success:function(c){apiResultsProcessingFun(c,function(){b.form.userInfo=c.result,b.form.getDeviceToken(),b.form.getUserPofile(a),b.$apply()})}})},b.init=function(){},b.init()}var RegistrationCtrl=["$filter","$scope","$location","$translate","$state","form","$timeout","shoppoDialog",registrationCtrl];angular.module("shoppoweb").controller("RegistrationCtrl",RegistrationCtrl);