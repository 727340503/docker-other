function cropImageCtrl(a,b,c,d,e,f,g,h){function i(a){var b=document.getElementById("canvas"),c=b.getContext("2d"),d=a.width,e=a.height;return b.width=d,b.height=e,c.imageSmoothingEnabled=!0,c.drawImage(a,0,0,d,e),c.globalCompositeOperation="destination-in",c.beginPath(),c.arc(d/2,e/2,Math.min(d,e)/2,0,2*Math.PI,!0),c.fill(),b}b.form=f,b.form.topBar.showTopBar=!0,b.form.topBar.topBarTitle=d.instant("profilePicture"),b.form.topBar.showBackBtn=!0,b.form.bottomMenu=!1,b.form.topBar.lastPage="main/changeProfilePicture",b.$root.gotoLastPage=function(){g(function(){c.path(b.form.topBar.lastPage)},200)},g(function(){$(".cropImage").css("height",$(window).height()-60),$(".cropper-container").css("height",$(window).height()-60)}),$(".setImg").attr("src",window.imgUrl);$(".setImg");g(function(){}),$("#crop").on("click",function(){var a,d,e;k&&(a=j.getCroppedCanvas(),d=i(a),e=document.createElement("img"),e.src=d.toDataURL(),$(".loader").show(),g(function(){window.setImg=!0;var d=document.getElementById("canvas"),f=d.getContext("2d");if(d.width=200,d.height=200,f.drawImage(a,e.x,e.y,e.width,e.height,0,0,d.width,d.height),window.trueImg=d.toDataURL("image/jpeg"),b.form.fromSetProfilePage)var h=apiDomain+uploadUserIcon;else var h=apiDomain+updateUserIcon;var i=copyData(b.form.userInfo);i.icon=window.trueImg,i.merchantId||(i.merchantId=b.form.merchantId),$.ajax({type:AJAX_TYPE,url:h,context:document.body,data:i,success:function(a){apiResultsProcessingFun(a,function(){g(function(){b.form.fromSetProfilePage?(b.form.userInfo.icon=a.result.imgDomain+"/"+a.result.iconName,b.form.userInfo.iconName=a.result.iconName):(b.form.userInfo.icon=a.result.icon,localStorage.setItem("userInfo",angular.toJson(b.form.userInfo))),c.path("main/changeProfilePicture"),b.$apply()})})}})},200))});var j,k=!1;g(function(){var a=document.getElementById("image");document.getElementById("crop");j=new Cropper(a,{aspectRatio:1,viewMode:1,cropBoxResizable:!1,minCropBoxWidth:200,minCropBoxHeight:200,dragMode:"move",ready:function(){k=!0}})})}var CropImageCtrl=["$filter","$scope","$location","$translate","$state","form","$timeout","shoppoDialog",cropImageCtrl];angular.module("shoppoweb").controller("CropImageCtrl",CropImageCtrl);