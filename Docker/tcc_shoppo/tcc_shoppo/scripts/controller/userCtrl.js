function userCtrl(a,b,c,d,e,f,g,h){b.form=f,b.form.topBar.showTopBar=!0,b.form.topBar.showMenuBtn=!1,f.topBar.showLogo=!1,b.form.topBar.topBarTitle=d.instant("Me"),b.form.topBar.showBackBtn=!1,b.form.topBar.showAddFirendBtn=!0,b.form.bottomMenu=!0,b.showReservation=!0,b.showStampHistory=!1,b.showRedeemHistory=!1,b.showFirends=!1,b.form.topBar.lastPage="",b.unexpiredCampaignList=[],b.pageNum=0,b.pageLimit=20,b.form.userInfo.icon||(b.form.userInfo.icon="images/user_default_photo.png");var j=!1;b.canGetMore=!0,b.swiperEvent=function(){if(!j){new Swiper(".swiper-container",{slidesPerView:"auto",centeredSlides:!1,spaceBetween:30,grabCursor:!0});j=!0}},b.showReservationContent=function(){b.showReservation||(b.showReservation=!0,b.showStampHistory=!1,b.showRedeemHistory=!1,b.showFirends=!1,b.reservationBar=!1,b.canGetMore=!0,b.pageNum=0,b.reservationList=[],0!=b.form.userInfo.userType&&(b.listUnReadStatus(),b.getUserReservationList()))},b.showStampHistoryContent=function(){b.showStampHistory||(b.showReservation=!1,b.showStampHistory=!0,b.showRedeemHistory=!1,b.showFirends=!1,b.stampHistoryBar=!1,b.canGetMore=!0,b.pageNum=0,b.stampHistoryList=[],0!=b.form.userInfo.userType&&(b.listUnReadStatus(),b.getStampHistoryList()))},b.showRedeemHistoryContent=function(){b.showRedeemHistory||(b.showReservation=!1,b.showStampHistory=!1,b.showRedeemHistory=!0,b.showFirends=!1,b.redeemHistoryBar=!1,b.canGetMore=!0,b.pageNum=0,b.redemptionHistoryList=[],0!=b.form.userInfo.userType&&(b.listUnReadStatus(),b.getRedeemtionHistoryList()))},b.instanceEvent=function(){$(".mainPage-content").bind("scroll",function(){var a=$(".mainPage-content").height(),c=$(".mainPage-content-style").height();$(".mainPage-content").scrollTop()>=c-a&&b.canGetMore&&(b.canGetMore=!1,b.pageNum++,b.showReservation&&b.getUserReservationList(),b.showStampHistory&&b.getStampHistoryList(),b.showRedeemHistory&&b.getRedeemtionHistoryList(),b.$apply())})},g(function(){$(".mainPage-content").css("height",$(".main-content").height()-167+"px"),b.instanceEvent()},100),b.showFriendsContent=function(){b.showFriends||(b.showReservation=!1,b.showStampHistory=!1,b.showRedeemHistory=!1,b.showFirends=!0,b.friendStatus=!1,0!=b.form.userInfo.userType&&(b.listUnReadStatus(),b.getFriendslist()))},b.getUserReservationList=function(){var a=copyData(b.form.userInfo),c=apiDomain+listUserReservation;a.pageNum=b.pageNum,a.pageLimit=b.pageLimit,$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){if(a.result.length>0){for(var c=0;c<a.result.length;c++)a.result[c].createdTime=formatDate(a.result[c].createdTime,b.form.dateFormat),a.result[c].reservationExpiredTime&&(a.result[c].reservationExpiredTime=formatDate(a.result[c].reservationExpiredTime,b.form.dateFormat)),b.reservationList.push(a.result[c]);if(b.reservationList.length>0){b.nowTime=new Date(Date.parse(b.reservationList[0].currDate.replace(/-/g,"/"))),b.nowTime=b.nowTime.getTime();for(var c=0;c<b.reservationList.length;c++)1==b.reservationList[c].status?b.reservationList[c].statusText="Confirmed":2==b.reservationList[c].status?(b.reservationList[c].statusText="Available at store",b.reservationList[c].position=!0):3==b.reservationList[c].status?b.reservationList[c].statusText="Cancelled":4==b.reservationList[c].status?b.reservationList[c].statusText="Expired":5==b.reservationList[c].status?b.reservationList[c].statusText="In-completed":6==b.reservationList[c].status&&(b.reservationList[c].statusText="Cancelled"),0==b.reservationList[c].readStatus&&(b.reservationBar=!0)}b.$apply(),a.result.length==b.pageLimit?b.canGetMore=!0:b.canGetMore=!1}})}})},b.getStampHistoryList=function(){var a=copyData(b.form.userInfo),c=apiDomain+listUserStampHistory;a.pageNum=b.pageNum,a.pageLimit=b.pageLimit,$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){if(a.result.length>0){for(var c=0;c<a.result.length;c++)a.result[c].createdTime=formatDate(a.result[c].createdTime,b.form.dateFormat),b.stampHistoryList.push(a.result[c]);for(var c=0;c<b.stampHistoryList.length;c++)1==b.stampHistoryList[c].type?b.stampHistoryList[c].typeText=d.instant("stampHistoryType1"):2==b.stampHistoryList[c].type?b.stampHistoryList[c].typeText=d.instant("stampHistoryType2"):3==b.stampHistoryList[c].type?b.stampHistoryList[c].typeText=d.instant("stampHistoryType3"):4==b.stampHistoryList[c].type?b.stampHistoryList[c].typeText=d.instant("stampHistoryType4"):5==b.stampHistoryList[c].type?b.stampHistoryList[c].typeText=d.instant("stampHistoryType5"):6==b.stampHistoryList[c].type?b.stampHistoryList[c].typeText=d.instant("stampHistoryType6"):7==b.stampHistoryList[c].type?b.stampHistoryList[c].typeText=d.instant("stampHistoryType7"):8==b.stampHistoryList[c].type&&(b.stampHistoryList[c].typeText=d.instant("stampHistoryType8")),0==b.stampHistoryList[c].readStatus&&(b.stampHistoryBar=!0);b.$apply(),a.result.length==b.pageLimit?b.canGetMore=!0:b.canGetMore=!1}})}})},b.getRedeemtionHistoryList=function(){var a=copyData(b.form.userInfo),c=apiDomain+listUserRedeemHistory;a.pageNum=b.pageNum,a.pageLimit=b.pageLimit,$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){if(a.result.length>0){for(var c=0;c<a.result.length;c++)a.result[c].redeemTime=formatDate(a.result[c].redeemTime,b.form.dateFormat),a.result[c].reservationDate&&(a.result[c].reservationDate=formatDate(a.result[c].reservationDate,b.form.dateFormat)),b.redemptionHistoryList.push(a.result[c]);for(var c=0;c<b.redemptionHistoryList.length;c++)0==b.redemptionHistoryList[c].readStatus&&(b.redeemHistoryBar=!0);b.$apply(),a.result.length==b.pageLimit?b.canGetMore=!0:b.canGetMore=!1}})}})},b.getFriendslist=function(){var a=copyData(b.form.userInfo),c=apiDomain+listUserFriend;$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.friendsList=a.result.listUserFriend,b.requestFriendsList=a.result.listUserRequsetFriend;for(var c=0;c<b.friendsList.length;c++)0==b.friendsList[c].readStatus&&(b.friendStatus=!0),b.friendsList[c].icon||(b.friendsList[c].icon="images/user_default_photo.png");for(var c=0;c<b.requestFriendsList.length;c++)0==b.requestFriendsList[c].readStatus&&(b.friendStatus=!0),b.requestFriendsList[c].icon||(b.requestFriendsList[c].icon="images/user_default_photo.png");b.$apply()})}})},b.acceptFriend=function(a){var c=copyData(b.form.userInfo);c.friendUserId=a.userId;var d=apiDomain+acceptFriend;$.ajax({type:AJAX_TYPE,data:c,url:d,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.getFriendslist(),b.$apply()})}})},b.listUnReadStatus=function(a){var c=copyData(b.form.userInfo),d=apiDomain+listHistoryUnReadStatus;$.ajax({type:AJAX_TYPE,data:c,url:d,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.listStatus=a.result,b.$apply()})}})},b.deleteFriendRequset=function(a){var c=copyData(b.form.userInfo);c.friendUserId=a.userId;var d=apiDomain+deleteFriendRequset;$.ajax({type:AJAX_TYPE,data:c,url:d,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){b.getFriendslist(),b.$apply()})}})},b.getListCampain=function(){var a=copyData(b.form.userInfo),c=apiDomain+listCampaign;$.ajax({type:AJAX_TYPE,data:a,url:c,context:document.body,success:function(a){apiResultsProcessingFun(a,function(){for(b.listCampaign=a.result,i=0;i<b.listCampaign.length;i++)2==b.listCampaign[i].status&&b.unexpiredCampaignList.push(b.listCampaign[i]);b.$apply()})}})},b.gotoRegistration=function(){b.form.isFromReservation=!0,c.path("main/registration")},b.gotoDetail=function(a){b.form.reservation=a,c.path("main/userReservationDetail")},b.gotoRedemptionHistory=function(a){b.form.redemptionHistory=a,c.path("main/redemptionHistory")},b.gotoStampsCard=function(){c.path("main/stampsCard")},b.gotoAddFriend=function(){c.path("main/addFriends")},0!=b.form.userInfo.userType&&b.listUnReadStatus(),b.init=function(){b.reservationList=[],0!=b.form.userInfo.userType&&(b.getUserReservationList(),b.getListCampain()),b.form.showFriendList&&(b.showFriendsContent(),b.form.showFriendList=!1),b.form.backFromRedempH&&(b.showRedeemHistoryContent(),b.form.backFromRedempH=!1)},b.init()}var UserCtrl=["$filter","$scope","$location","$translate","$state","form","$timeout","shoppoDialog",userCtrl];angular.module("shoppoweb").controller("UserCtrl",UserCtrl);