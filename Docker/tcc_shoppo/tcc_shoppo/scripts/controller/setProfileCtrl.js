function setProfileCtrl(a,b,c,d,e,f,g,h){b.form=f,b.form.topBar.showTopBar=!0,b.form.topBar.topBarTitle=d.instant("Your profile"),b.form.topBar.showBackBtn=!1,b.form.bottomMenu=!1,b.$root.gotoLastPage=function(){g(function(){c.path(b.form.topBar.lastPage)},200)},b.page=1,b.overResendTimes=!0,b.haveSendCode=!1,b.form.userInfo.icon||(b.form.userInfo.icon="images/user_default_photo.png"),2==b.form.registerType||b.form.userInfo.phone?b.checkPhone=!0:b.checkPhone=!1,0!=b.form.isMarketingInfo&&1!=b.form.isMarketingInfo&&(b.form.isMarketingInfo=0),b.gotoLanding=function(){g(function(){c.path("main/landing")},200)},b.gotoChangeProfilePicture=function(){b.form.fromSetProfilePage=!0,c.path("main/changeProfilePicture")},b.genderList=[{name:"Male"},{name:"Female"}];jQuery.validator.addMethod("checkSpace",function(a,b,c){return 0!=a.replace(/\s/g,"").length},$.validator.format("Cannot be an empty string")),jQuery.validator.addMethod("checkName",function(a,b,c){return 0==a.replace(/^[a-z\d]{6,12}$/,"").length},$.validator.format("")),b.$watch(function(){return $(".userName").val()},function(a,b){0!=$(".userName").val().replace(/^[a-z\d]{6,12}$/,"").length?$(".usernameformat").css("color","#cc5965"):$(".usernameformat").css("color","#4f4f4f")}),$(".userName").blur(function(){$("#userName-error").css("display","none")}),$("#setProfile").validate({errorPlacement:function(a,b){b.after(a)},rules:{userName:{required:!1,checkName:!0},email:{required:!1}},messages:{},submitHandler:function(a){1==b.form.userInfo.userType||2==b.form.userInfo.userType||3==b.form.userInfo.userType?b.updateUserPofile():b.registerEvent()}}),b.$watch(function(){return $(".contactEmail").val()},function(a,b){$(".contactEmail").val(trim(a))}),b.canConfirm=!1,b.$watch("form.userInfo",function(a,c){b.checkConfirmBtn()},!0),b.checkConfirmBtn=function(){$(".userName").val()&&$(".firstName").val()&&$(".lastName").val()&&b.form.userInfo.phoneAreaCode&&b.form.userInfo.phone&&($(".contactEmail").val()||b.form.userInfo.contactEmail)?b.canConfirm=!0:b.canConfirm=!1},b.submit=function(){$("#setProfile").submit()},b.$root.closePopup=function(){b.overResendTimes=!0,b.form.topBar.topBarTitle=d.instant("setProfile"),$(".verifyCodeInput").blur(),$(".phoneInput").blur(),g(function(){b.page=1,b.form.topBar.showCloseBtn=!1})},b.openPopup=function(){b.haveSendCode?b.verifyCodePage():b.setPhonePage()},b.resetMobileEvent=function(){b.setPhonePage(),b.haveSendCode=!1},b.setPhonePage=function(){$(".main-content").scrollTop(0),g(function(){b.page=2,$(".phoneInput").focus(),b.form.topBar.showCloseBtn=!0},200)},b.verifyCodePage=function(){$(".main-content").scrollTop(0),g(function(){b.page=3,$(".verifyCodeInput").focus(),b.form.topBar.showCloseBtn=!0},200)},b.sendSmsEvent=function(a){$(".phoneInput").blur(),g(function(){var c=copyData(b.form.userInfo);c.phoneAreaCode=b.phoneAreaCode.replace("+","00"),c.phone=b.phone,c.verifyType=a;var d=apiDomain+sendSms;$.ajax({type:AJAX_TYPE,url:d,context:document.body,data:c,success:function(a){apiResultsProcessingFun(a,function(){10484==a.errorCode?angular.element("body").scope().$root.warningDlg({msg:a.errorMessage}):(b.haveSendCode=!0,b.verifyCodePage(),b.timeEvent()),b.$apply()})}})},200)},b.time=0;var i;b.timeEvent=function(){b.time=60,i&&clearInterval(i),i=setInterval(function(){b.time--,b.time<=0&&(clearInterval(i),b.time=0),b.$apply()},1e3)},b.resendSmsEvent=function(){if(0==b.time){var a=copyData(b.form.userInfo);a.phoneAreaCode=b.phoneAreaCode.replace("+","00"),a.phone=b.phone,a.verifyType=1;var c=apiDomain+resendSms;$.ajax({type:AJAX_TYPE,url:c,context:document.body,data:a,success:function(a){apiResultsProcessingFun(a,function(){10484==a.errorCode?(b.overResendTimes=!1,angular.element("body").scope().$root.warningDlg({msg:a.errorMessage}),b.$apply()):(b.overResendTimes=!0,b.timeEvent()),b.$apply()})}})}},b.verifySmsEvent=function(){if(b.verifyCode){var a=copyData(b.form.userInfo);a.phoneAreaCode=b.phoneAreaCode.replace("+","00"),a.phone=b.phone,a.verifyType=1,a.verifyCode=b.verifyCode;var c=apiDomain+verifySms;$.ajax({type:AJAX_TYPE,url:c,context:document.body,data:a,success:function(a){apiResultsProcessingFun(a,function(){b.form.userInfo.phoneAreaCode=b.phoneAreaCode,b.form.userInfo.phone=b.phone,b.checkPhone=!0,b.checkConfirmBtn(),b.$root.closePopup(),b.$apply()})}})}},$("#login").validate({errorPlacement:function(a,b){b.after(a)},rules:{},submitHandler:function(a){b.sendSmsEvent(1)}}),b.submitEvent=function(){$("#login").submit()},b.$watch("form.userInfo.userName",function(a,c){b.form.userInfo.userName=a.toLocaleLowerCase()}),b.$on("onRepeatLast",function(a,c,d){$("#phoneAreaCode").mobiscroll().treelist({theme:"ios",display:"bottom",lang:"en_US",labels:["business"],onSelect:function(a,c){a=a.substr(a.indexOf("+"),a.length),$("#phoneAreaCode_dummy").val(a),a=a.replace("+","00"),b.phoneAreaCode=a}});g(function(){b.form.userInfo.phoneAreaCode?(b.phoneAreaCode=b.form.userInfo.phoneAreaCode,$("#phoneAreaCode_dummy").val(phoneCodeFormat(b.form.userInfo.phoneAreaCode))):(b.phoneAreaCode=b.form.phoneAreaCode,$("#phoneAreaCode_dummy").val(phoneCodeFormat(b.phoneAreaCode)))},200)}),g(function(){$("#birthday").mobiscroll().date({theme:"ios",mode:"scroller",display:"bottom",dateFormat:"yyyy-mm-dd",lang:"en_US",maxDate:new Date,defaultValue:new Date("1990/01/01 00:00:00")});$("#gender").mobiscroll().treelist({theme:"ios",display:"bottom",lang:"en_US",labels:["business"],onSelect:function(a,c){b.form.userInfo.gender=a,b.checkConfirmBtn()}});$("#gender_dummy").val(b.form.userInfo.gender),$(".dwwc").css("display","-webkit-flex"),b.checkConfirmBtn()}),b.registerEvent=function(){var a=copyData(b.form.userInfo);$(".userName").val()&&!b.form.userInfo.userName&&(a.userName=$(".userName").val()),$(".firstName").val()&&!b.form.userInfo.firstName&&(a.firstName=$(".firstName").val()),$(".lastName").val()&&!b.form.userInfo.lastName&&(a.lastName=$(".lastName").val()),$(".contactEmail").val()&&!b.form.userInfo.contactEmail&&(a.contactEmail=$(".contactEmail").val()),a.langCode||(a.langCode=b.form.langCode),a.registerType=b.form.registerType,a.smsVerifyId=b.smsVerifyId,a.isMarketingInfo=b.form.isMarketingInfo,b.form.facebookInfo&&(a.snsId=b.form.facebookInfo.id,a.snsType=1,a.snsAccessToken=b.form.facebookInfo.token);var c=apiDomain+newRegister;$.ajax({type:AJAX_TYPE,url:c,context:document.body,data:a,success:function(a){0==a.errorCode?(b.form.userInfo.userName=b.form.userInfo.userName.toLowerCase(),b.form.userInfo.userId=a.result.userId,b.form.userInfo.session=a.result.session,b.form.getPofile(function(){b.gotoLanding()}),b.form.getDeviceToken()):10425==a.errorCode?(b.form.facebookInfo={},b.$root.warningDlg({msg:a.errorMessage})):b.$root.warningDlg({msg:a.errorMessage}),b.$apply()}})},b.updateUserPofile=function(){var a=copyData(b.form.userInfo);$(".userName").val()&&!b.form.userInfo.userName&&(a.userName=$(".userName").val()),$(".firstName").val()&&!b.form.userInfo.firstName&&(a.firstName=$(".firstName").val()),$(".lastName").val()&&!b.form.userInfo.lastName&&(a.lastName=$(".lastName").val()),$(".contactEmail").val()&&!b.form.userInfo.contactEmail&&(a.contactEmail=$(".contactEmail").val()),a.isMarketingInfo=b.form.isMarketingInfo;var c=apiDomain+updateUserPofile;$.ajax({type:AJAX_TYPE,url:c,context:document.body,data:a,success:function(a){0==a.errorCode?(b.form.userInfo.userName=b.form.userInfo.userName.toLowerCase(),b.form.getPofile(function(){b.gotoLanding()})):10425==a.errorCode?(b.form.facebookInfo={},b.$root.warningDlg({msg:a.errorMessage})):b.$root.warningDlg({msg:a.errorMessage}),b.$apply()}})},b.$watch("form.userInfo.phone",function(a,c){new RegExp("^[0-9]*$").test(a)?b.form.userInfo.phone=a:b.form.userInfo.phone=c,""!=a&&a||(b.form.userInfo.phone="")}),b.facebookLogin=function(){3!=b.form.registerType&&(getfaceBookUserInfo=function(a){var c=JSON.parse(a.result);b.checkFbEvent(c)},1==b.form.isInApp&&(window.location.href="tcc://shoppo?func=facebookLogin&callback=getfaceBookUserInfo"))},b.checkFbEvent=function(a){var c=copyData(b.form.userInfo);c.snsId=a.id,c.snsType=1,c.snsAccessToken=a.token;var d=apiDomain+checkIsExistFbAccount;$.ajax({type:AJAX_TYPE,url:d,context:document.body,data:c,success:function(c){apiResultsProcessingFun(c,function(){1==c.result?angular.element("body").scope().$root.warningDlg({msg:"An account already exists under this Facebook account."}):b.form.facebookInfo=a,b.$apply()})}})},b.getUserPofile=function(){var a=copyData(b.form.userInfo),c=apiDomain+getUserPofile;$.ajax({type:AJAX_TYPE,url:c,context:document.body,data:a,success:function(a){apiResultsProcessingFun(a,function(){b.form.userInfo=$.extend(b.form.userInfo,a.result),b.$apply()})}})},b.iconClick=function(a){$("#"+a+"_dummy").click()},b.birthdayClick=function(){$("#birthday").click()},b.init=function(){},b.init()}var SetProfileCtrl=["$filter","$scope","$location","$translate","$state","form","$timeout","shoppoDialog",setProfileCtrl];angular.module("shoppoweb").controller("SetProfileCtrl",SetProfileCtrl);