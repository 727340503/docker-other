function customerDetailCtrl(a,b,c,d,e,f,g,h){a.form=e,a.cancel=function(){f.path("/main/customerList")},a.getCustomerDetail=function(){var b=apiDomain+getUserDetailApi,c=copyData(a.form.userInfo);c.customerId=a.form.customerId,$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.customerDetail=b.result,a.customerDetail.isMarketingInfo=a.customerDetail.isMarketingInfo?"Yes":"No",a.customerDetail.userType=a.mappingUserType(a.customerDetail.userType,a.customerDetail.snsType),a.customerDetail.status=a.mappingUserStatus(a.customerDetail.status),a.customerDetail.phone?a.customerDetail.phoneNumber=a.form.phoneCodeFormat(a.customerDetail.phoneAreaCode)+" - "+a.customerDetail.phone:a.customerDetail.phoneNumber="",a.$apply()})}})},a.mappingUserStatus=function(a){var b="";switch(a){case 1:b=h("translate")("Active");break;case 0:b=h("translate")("Inactive");break;default:b=a}return b},a.mappingUserType=function(a,b){var c="";switch(a){case 1:c="Email user";break;case 2:c="Phone user";break;case 3:1==b&&(c="Facebook user");break;default:c=a}return c},a.changeTab=function(a){d(function(){$(".tab"+a).parent().find("a").click()})},a.form.stampHistory&&(a.changeTab(2),a.form.stampHistory=!1),a.form.reservationHistory&&(a.changeTab(5),a.form.reservationHistory=!1),a.showTab=function(b,c){switch(b.preventDefault(),c){case"StampHistory":a.showStamp=!0,a.form.campaignId="",a.searchStampHistory(),a.getCampaignList(),d(function(){$(b.target).tab("show")},10);break;case"redemptionHistory":a.redemption=!0,a.searchRedeem(),d(function(){$(b.target).tab("show")},10);break;case"reservationHistory":a.reservation=!0,a.searchReservation(),d(function(){$(b.target).tab("show")},10);break;case"coupon":a.coupon=!0,a.searchCoupon(),d(function(){$(b.target).tab("show")},10)}},a.showStamp=!1,a.redemption=!1,a.reservation=!1;var i={pageNumber:1,pageSize:30,sort:null};a.gridOptions={paginationPageSize:30,enableVerticalScrollbar:0,enableGridMenu:!1,useExternalPagination:!0,useExternalSorting:!0,enableColumnResizing:!0,enableFullRowSelection:!1,enablePaginationControls:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,noUnselect:!1,rowHeight:48,enableRowSelection:!0,enableRowHeaderSelection:!1,rowTemplate:'<div  ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',columnDefs:[{name:"Campaign",field:"campaignName",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Transaction Type",field:"type",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"No. of stamps In/out",field:"stampQty",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Created Time",field:"createdTime",minWidth:20,width:140,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Handled by",field:"createdBy",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Remark",field:"remarks",minWidth:20,width:140,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"POS Transaction Time",displayName:"POS Transaction Time",field:"transDateTime",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"POS Transaction No.",displayName:"POS Transaction No.",field:"transNo",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"}],onRegisterApi:function(b){a.gridApi=b,a.gridApi.core.on.sortChanged(a,function(b,c){if(0==c.length)a.sortField="id",a.sortType="DESC";else{for(;c.length>1;)c[0].unsort(),c.shift();a.sortField=c[0].field,a.sortType=c[0].sort.direction.toUpperCase()}j()}),b.pagination.on.paginationChanged(a,function(a,b){i.pageNumber=a,i.pageSize=b,j()}),a.onDblClick=function(a){},b.pagination.displayPage=function(){var a=[],c=0,d=b.pagination.getTotalPages(),e=5;b.pagination.getTotalPages()>e&&(b.pagination.getPage()>Math.ceil(e/2)?(c=b.pagination.getPage()-Math.ceil(e/2),d=b.pagination.getPage()+Math.floor(e/2),b.pagination.getPage()>b.pagination.getTotalPages()-Math.floor(e/2)&&(c=b.pagination.getTotalPages()-e),d>b.pagination.getTotalPages()&&(d=b.pagination.getTotalPages())):d=e);for(var f=c;f<d;f++)a.push(f+1);return a}}},a.getTableHeight=function(){var b=a.gridOptions.rowHeight;return{height:a.gridOptions.data.length*b+68+"px"}};var j=function(){var b=(i.pageNumber-1)*i.pageSize,c=i.pageSize,d=b+c,e=apiDomain+getUserStampHistoryListApi,f=copyData(a.form.userInfo);f.customerId=a.form.customerId,f.langCode=a.searchLanguage,f.startRow=b,f.maxRows=c,f.sortType=a.sortType,f.sortField=a.sortField,f.campaignId=a.form.campaignId,$.ajax({type:a.form.postType,url:e,context:document.body,data:f,success:function(c){apiResultsProcessingFun(c,function(){a.gridOptions.totalItems=c.result.totalRows,a.gridOptions.data=c.result.resultList,a.gridOptions.startItem=b+1,a.form.campaignId&&null==c.totalStampNo&&(c.totalStampNo=0),0==b&&(a.totalStampNo=c.totalStampNo),d>a.gridOptions.totalItems&&(d=a.gridOptions.totalItems),0==a.gridOptions.totalItems&&(a.gridOptions.startItem=0),a.gridOptions.endItem=d,a.gridOptions.data.forEach(function(b,c){b.type=a.mappingType(b.type)}),a.$apply()})}})};a.mappingType=function(a){var b="";switch(a){case 1:b="Collect stamps";break;case 2:b="Transfer out stamps";break;case 3:b="Transfer in stamps";break;case 4:b="redeem";break;case 5:b="Reservation";break;case 6:b="System in stamps";break;case 7:b="System out stamps";break;case 8:b="Free stamps";break;default:b=a}return b},a.searchStampHistory=function(){a.sortField="id",a.sortType="DESC",j()},a.selectCampaign=function(){a.searchStampHistory();for(var b=0;b<a.campaignList.length;b++)a.campaignList[b].id==a.form.campaignId&&(a.form.campaignName=a.campaignList[b].name)},a.gridOptionsRedeem={paginationPageSize:30,enableVerticalScrollbar:0,enableGridMenu:!1,useExternalPagination:!0,useExternalSorting:!0,enableColumnResizing:!0,enableFullRowSelection:!1,enablePaginationControls:!1,multiSelect:!0,modifierKeysToMultiSelect:!1,noUnselect:!1,rowHeight:48,enableRowSelection:!0,enableRowHeaderSelection:!1,rowTemplate:'<div  ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',columnDefs:[{name:"Campaign",field:"campaignName",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Reward title",field:"giftName",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Created Time",field:"createdTime",minWidth:20,width:140,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Stamps no.",field:"stampQty",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"POS Transaction time",displayName:"POS Transaction time",field:"transDateTime",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"POS Transaction No.",displayName:"POS Transaction No.",field:"transNo",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"}],onRegisterApi:function(b){a.gridApiRedeem=b,a.gridApiRedeem.core.on.sortChanged(a,function(b,c){if(0==c.length)a.sortField="id",a.sortType="DESC";else{for(;c.length>1;)c[0].unsort(),c.shift();a.sortField=c[0].field,a.sortType=c[0].sort.direction.toUpperCase()}k()}),b.pagination.on.paginationChanged(a,function(a,b){i.pageNumber=a,i.pageSize=b,k()}),a.onDblClick=function(a){},b.pagination.displayPage=function(){var a=[],c=0,d=b.pagination.getTotalPages(),e=5;b.pagination.getTotalPages()>e&&(b.pagination.getPage()>Math.ceil(e/2)?(c=b.pagination.getPage()-Math.ceil(e/2),d=b.pagination.getPage()+Math.floor(e/2),b.pagination.getPage()>b.pagination.getTotalPages()-Math.floor(e/2)&&(c=b.pagination.getTotalPages()-e),d>b.pagination.getTotalPages()&&(d=b.pagination.getTotalPages())):d=e);for(var f=c;f<d;f++)a.push(f+1);return a}}},a.getTableHeightRedeem=function(){var b=a.gridOptionsRedeem.rowHeight;return{height:a.gridOptionsRedeem.data.length*b+68+"px"}};var k=function(){var b=(i.pageNumber-1)*i.pageSize,c=i.pageSize,d=b+c,e=apiDomain+getUserRedeemHistoryListApi,f=copyData(a.form.userInfo);f.startRow=b,f.maxRows=c,f.sortType=a.sortType,f.sortField=a.sortField,f.customerId=a.form.customerId,$.ajax({type:a.form.postType,url:e,context:document.body,data:f,success:function(c){apiResultsProcessingFun(c,function(){a.gridOptionsRedeem.totalItems=c.totalRows,a.gridOptionsRedeem.data=c.resultList,a.gridOptionsRedeem.startItem=b+1,d>a.gridOptionsRedeem.totalItems&&(d=a.gridOptionsRedeem.totalItems),0==a.gridOptionsRedeem.totalItems&&(a.gridOptionsRedeem.startItem=0),a.gridOptionsRedeem.endItem=d,a.gridOptionsRedeem.data.forEach(function(b,c){b.type=a.mappingType(b.type)}),a.$apply()})}})};a.searchRedeem=function(){a.sortField="id",a.sortType="DESC",k()},a.gridOptionsReservation={paginationPageSize:30,enableVerticalScrollbar:0,enableGridMenu:!1,useExternalPagination:!0,useExternalSorting:!0,enableColumnResizing:!0,enableFullRowSelection:!1,enablePaginationControls:!1,multiSelect:!0,modifierKeysToMultiSelect:!1,noUnselect:!1,rowHeight:48,enableRowSelection:!0,enableRowHeaderSelection:!1,rowTemplate:'<div ios-dblclick="grid.appScope.onDblClick(row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',columnDefs:[{name:"Campaign",field:"campaignName",minWidth:20,width:140,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Reserved Reward",field:"giftName",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Reservation status",field:"status",minWidth:20,width:140,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Reservation Code",field:"reservationCode",minWidth:20,width:140,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Reservation date",field:"createdTime",minWidth:20,width:140,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Pick up store name",field:"storeName",minWidth:20,width:140,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Reservation expiry date",field:"reservationExpiredTime",minWidth:20,width:180,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"}],onRegisterApi:function(b){a.gridApiReservation=b,a.gridApiReservation.core.on.sortChanged(a,function(b,c){if(0==c.length)a.sortField="id",a.sortType="DESC";else{for(;c.length>1;)c[0].unsort(),c.shift();a.sortField=c[0].field,a.sortType=c[0].sort.direction.toUpperCase()}l()}),b.pagination.on.paginationChanged(a,function(a,b){i.pageNumber=a,i.pageSize=b,l()}),a.onDblClick=function(b){a.form.userReservationId=b.entity.id,f.path("/main/customerReservationDetail")},b.pagination.displayPage=function(){var a=[],c=0,d=b.pagination.getTotalPages(),e=5;b.pagination.getTotalPages()>e&&(b.pagination.getPage()>Math.ceil(e/2)?(c=b.pagination.getPage()-Math.ceil(e/2),d=b.pagination.getPage()+Math.floor(e/2),b.pagination.getPage()>b.pagination.getTotalPages()-Math.floor(e/2)&&(c=b.pagination.getTotalPages()-e),d>b.pagination.getTotalPages()&&(d=b.pagination.getTotalPages())):d=e);for(var f=c;f<d;f++)a.push(f+1);return a}}},a.getTableHeightReservation=function(){var b=a.gridOptionsReservation.rowHeight;return{height:a.gridOptionsReservation.data.length*b+68+"px"}};var l=function(){var b=(i.pageNumber-1)*i.pageSize,c=i.pageSize,d=b+c,e=apiDomain+getUserReservationListApi,f=copyData(a.form.userInfo);f.userName=a.searchUserName,f.langCode=a.searchLanguage,f.startRow=b,f.maxRows=c,f.sortType=a.sortType,f.sortField=a.sortField,f.merchantId=a.form.merchantId,f.status=a.searchStatus,f.customerId=a.form.customerId,$.ajax({type:a.form.postType,url:e,context:document.body,data:f,success:function(c){apiResultsProcessingFun(c,function(){a.gridOptionsReservation.totalItems=c.totalRows,a.gridOptionsReservation.data=c.resultList,a.gridOptionsReservation.startItem=b+1,d>a.gridOptionsReservation.totalItems&&(d=a.gridOptionsReservation.totalItems),0==a.gridOptionsReservation.totalItems&&(a.gridOptionsReservation.startItem=0),a.gridOptionsReservation.endItem=d,a.gridOptionsReservation.data.forEach(function(b,c){b.status=a.mappingStatusReservation(b.status)}),a.$apply(),$(".ui-grid-row").css("cursor","pointer")})}})};a.mappingStatusReservation=function(a){var b="";switch(a){case 1:b=h("translate")("Confirmed");break;case 2:b=h("translate")("Available at store");break;case 3:b=h("translate")("Settled");break;case 4:b=h("translate")("Expired");break;case 5:b=h("translate")("Incompleted");break;case 6:b=h("translate")("Cancelled");break;default:b=a}return b},a.searchReservation=function(){a.sortField="id",a.sortType="DESC",l()},a.gridOptionsCoupon={paginationPageSize:30,enableVerticalScrollbar:0,enableGridMenu:!1,useExternalPagination:!0,useExternalSorting:!0,enableColumnResizing:!0,enableFullRowSelection:!1,enablePaginationControls:!1,multiSelect:!0,modifierKeysToMultiSelect:!1,noUnselect:!1,rowHeight:48,enableRowSelection:!0,enableRowHeaderSelection:!1,rowTemplate:'<div  ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',columnDefs:[{name:"Coupon type",field:"type",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Coupon title",field:"couponName",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Campaign",field:"campaignName",minWidth:20,width:140,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Collected time",field:"createdTime",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Redeemed time",field:"redeemedDate",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Expiry date",field:"expiredTime",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Status",field:"status",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Handled by",field:"handledBy",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Remark",field:"remark",minWidth:100,width:175,enableSorting:!0,enableColumnResizing:!0,headerCellClass:"myTableHeader"}],onRegisterApi:function(b){a.gridApiCoupon=b,a.gridApiCoupon.core.on.sortChanged(a,function(b,c){if(0==c.length)a.sortField="id",a.sortType="DESC";else{for(;c.length>1;)c[0].unsort(),c.shift();a.sortField=c[0].field,a.sortType=c[0].sort.direction.toUpperCase()}m()}),b.pagination.on.paginationChanged(a,function(a,b){i.pageNumber=a,i.pageSize=b,m()}),a.onDblClick=function(a){},b.pagination.displayPage=function(){var a=[],c=0,d=b.pagination.getTotalPages(),e=5;b.pagination.getTotalPages()>e&&(b.pagination.getPage()>Math.ceil(e/2)?(c=b.pagination.getPage()-Math.ceil(e/2),d=b.pagination.getPage()+Math.floor(e/2),b.pagination.getPage()>b.pagination.getTotalPages()-Math.floor(e/2)&&(c=b.pagination.getTotalPages()-e),d>b.pagination.getTotalPages()&&(d=b.pagination.getTotalPages())):d=e);for(var f=c;f<d;f++)a.push(f+1);return a}}},a.getTableHeightCoupon=function(){var b=a.gridOptionsCoupon.rowHeight;return{height:a.gridOptionsCoupon.data.length*b+68+"px"}};var m=function(){var b=(i.pageNumber-1)*i.pageSize,c=i.pageSize,d=b+c,e=apiDomain+getUserCouponListApi,f=copyData(a.form.userInfo);f.startRow=b,f.maxRows=c,f.sortType=a.sortType,f.sortField=a.sortField,f.customerId=a.form.customerId,$.ajax({type:a.form.postType,url:e,context:document.body,data:f,success:function(c){apiResultsProcessingFun(c,function(){a.gridOptionsCoupon.totalItems=c.totalRows,a.gridOptionsCoupon.data=c.resultList,a.gridOptionsCoupon.startItem=b+1,d>a.gridOptionsCoupon.totalItems&&(d=a.gridOptionsCoupon.totalItems),0==a.gridOptionsCoupon.totalItems&&(a.gridOptionsCoupon.startItem=0),a.gridOptionsCoupon.endItem=d,a.gridOptionsCoupon.data.forEach(function(b,c){b.type=a.mappingTypeCoupon(b.type),b.status=a.mappingStatusCoupon(b.status)}),a.$apply()})}})};a.mappingStatusCoupon=function(a){var b="";switch(a){case 1:b="Active";break;case 2:b="Redeem";break;case 3:b="Expired";break;case 4:b="Inactive";break;default:b=a}return b},a.mappingTypeCoupon=function(a){var b="";switch(a){case 1:b="Stamp(Add)";break;default:b=a}return b},a.searchCoupon=function(){a.sortField="id",a.sortType="DESC",m()},a.getCampaignList=function(){var b=apiDomain+getCustomerCampaignApi,c=copyData(a.form.userInfo);c.customerId=a.form.customerId,c.status=2,$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.campaignList=b.result,a.$apply()})}})},a.AdjustStamps=function(){a.form.merchantName=a.customerDetail.merchantName,f.path("/main/customerAdjustStamps")},a.AdjustCoupon=function(){a.form.merchantName=a.customerDetail.merchantName,f.path("/main/customerAdjustCoupon")},a.init=function(){a.form.customerId&&a.getCustomerDetail()},a.init()}var CustomerDetailCtrl=["$scope","$translate","$state","$timeout","form","$location","$modal","$filter",customerDetailCtrl];angular.module("keeperp").controller("CustomerDetailCtrl",CustomerDetailCtrl);