function merchantDetailCtrl(a,b,c,d,e,f,g){a.form=e,a.cancel=function(){f.path("/main/merchantList")},a.canUpdateKey=!1,$("#baseInfo").validate({errorPlacement:function(a,b){b.parent().after(a)},rules:{merchantName:{required:!0}},messages:{},submitHandler:function(b){a.newMerchant?a.createMerchant():a.updateMerchant()}}),a.createMerchant=function(){a.turnLoginMethonType();var b=apiDomain+createMerchantApi,c=copyData(a.form.userInfo);c.timeZone=a.merchantDetail.timeZone,c.securityKey=a.merchantDetail.securityKey,c.loginMethod=a.merchantDetail.loginMethod,c.dateFormat=a.merchantDetail.dateFormat,c.hoursFormat="24",c.currencyUnitId=a.merchantDetail.currencyUnitId,c.issueStampMethod=a.merchantDetail.issueStampMethod,c.reservationType=a.merchantDetail.reservationType,c.phoneDistrictCode=a.merchantDetail.phoneDistrictCode,c.status=a.merchantDetail.status,c.mapType=a.merchantDetail.mapType,c.isCouponManagement=a.merchantDetail.isCouponManagement,c.langData=[];for(var e=0;e<a.form.languageList.length;e++)a.form.languageList[e].select&&(a.defaultLanguage==a.form.languageList[e].langCode?c.langData.push({name:a.merchantDetail.langData.name,logo:a.logo,img:a.img,descr:a.merchantDetail.langData.descr,isDefault:!0,langCode:a.form.languageList[e].langCode}):c.langData.push({name:"",logo:"",img:"",descr:"",isDefault:!1,langCode:a.form.languageList[e].langCode}));c.langData=angular.toJson(c.langData),$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.alert("success"," ","Success！"),d(function(){f.path("/main/merchantList")})})}})},a.getMerchantDetail=function(){var b=apiDomain+getMerchantDetailApi,c=copyData(a.form.userInfo);c.merchantId=a.form.merchantId,$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.merchantDetail=b.result,a.merchantDetail.loginMethod=a.merchantDetail.loginMethod.split(",");for(var c=0;c<=a.merchantDetail.loginMethod.length;c++)a.loginMethod[a.merchantDetail.loginMethod[c]-1]=!0;a.merchantDetail.status+="",a.merchantDetail.mapType+="",a.merchantDetail.issueStampMethod+="",a.merchantDetail.currencyUnitId+="",a.merchantDetail.reservationType+="";for(var c=0;c<a.merchantDetail.merchantLangMapList.length;c++){a.merchantDetail.merchantLangMapList[c].isDefault&&(a.pageLanguage=a.merchantDetail.merchantLangMapList[c].langCode,a.defaultLanguage=a.merchantDetail.merchantLangMapList[c].langCode,a.merchantDetail.defaultLangCode=a.merchantDetail.merchantLangMapList[c].langCode,a.merchantDetail.langData=a.merchantDetail.merchantLangMapList[c]);for(var d=0;d<a.form.languageList.length;d++)a.merchantDetail.merchantLangMapList[c].langCode==a.form.languageList[d].langCode&&(a.form.languageList[d].select=!0)}a.$apply()})}})},a.updateMerchant=function(){a.turnLoginMethonType();var b=apiDomain+updateMerchantApi,c=copyData(a.form.userInfo);c.merchantId=a.form.merchantId,c.updatedTime=a.merchantDetail.updatedTime,c.loginMethod=a.merchantDetail.loginMethod,c.defaultLangCode=a.merchantDetail.defaultLangCode,c.issueStampMethod=a.merchantDetail.issueStampMethod,c.isCouponManagement=a.merchantDetail.isCouponManagement,c.phoneDistrictCode=a.merchantDetail.phoneDistrictCode,c.reservationType=a.merchantDetail.reservationType,c.dateFormat=a.merchantDetail.dateFormat,c.hoursFormat="24",c.status=a.merchantDetail.status,c.mapType=a.merchantDetail.mapType,a.merchantDetail.langData.logo=a.logo,a.merchantDetail.langData.img=a.img,c.langData=[{}],c.langData[0]=a.merchantDetail.langData,c.langData=angular.toJson(c.langData),$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.alert("success"," ","Success！"),a.getMerchantDetail()})}})},a.changeSecurityKey=function(){function b(a,b,c,d,e){a.showOk=!0,a.msg="Confirm changing security code?",a.cancel=function(){b.dismiss("cancel")},a.ok=function(){a.getSecurityKey(),b.dismiss("cancel")}}var c=["$scope","$modalInstance","$state","$translate","$filter",b];g.open({templateUrl:"pages/common/warningDlg.html",controller:c,scope:a})},a.getSecurityKey=function(){var b=apiDomain+generateMerchantSecurityKeyApi,c={},c=copyData(a.form.userInfo);$.ajax({type:e.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){d(function(){a.merchantDetail.securityKey=b.result,a.form.merchantId&&a.updateMerchantSecurityKey()})})}})},a.updateMerchantSecurityKey=function(){var b=apiDomain+updateMerchantSecurityKeyApi,c={},c=copyData(a.form.userInfo);c.merchantId=a.form.merchantId,c.securityKey=a.merchantDetail.securityKey,$.ajax({type:e.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){d(function(){a.alert("success"," ","Success！")})})}})},a.getCurrencyUnitlist=function(){var b=apiDomain+getCurrencyUnitlistApi,c={},c=copyData(a.form.userInfo);$.ajax({type:e.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){d(function(){a.currencyUnitlist=b.result})})}})},a.getMerchantSecurityKey=function(b){var c=apiDomain+getMerchantSecurityKeyApi,f={},f=copyData(a.form.userInfo);f.password=b,f.merchantId=a.form.merchantId,$.ajax({type:e.postType,url:c,context:document.body,data:f,success:function(b){apiResultsProcessingFun(b,function(){d(function(){a.merchantDetail.securityKey=b.result,a.canUpdateKey=!0})})}})},a.setDefault=function(){a.merchantDetail.langData.isDefault?a.merchantDetail.langData.isDefault=!1:a.merchantDetail.langData.isDefault=!0},a.checkLoginType=function(b){a.loginMethod[b]?a.loginMethod[b]=!1:a.loginMethod[b]=!0},a.checkCoupon=function(){a.merchantDetail.isCouponManagement?a.merchantDetail.isCouponManagement=0:a.merchantDetail.isCouponManagement=1},a.turnLoginMethonType=function(){a.merchantDetail.loginMethod=[];for(var b=0;b<a.loginMethod.length;b++)a.loginMethod[b]&&a.merchantDetail.loginMethod.push(b+1);a.merchantDetail.loginMethod=a.merchantDetail.loginMethod.join(",")},a.checkboxLanguage=function(b){for(var c=0;c<a.form.languageList.length;c++)b==a.form.languageList[c].langCode&&(a.form.languageList[c].select?a.form.languageList[c].select=!1:a.form.languageList[c].select=!0)},a.checkdefaultLang=function(b){a.merchantDetail.defaultLangCode=b},a.selectPageLang=function(){d(function(){for(var b=0;b<a.merchantDetail.merchantLangMapList.length;b++)a.merchantDetail.merchantLangMapList[b].langCode==a.pageLanguage&&(a.merchantDetail.langData=a.merchantDetail.merchantLangMapList[b])})},a.viewSecurityKey=function(){function b(a,b,c,d,e){a.showOk=!0,a.msg=e("translate")("AreYouSure"),a.cancel=function(){b.dismiss("cancel")},a.ok=function(){a.getMerchantSecurityKey(a.getKeyPassword),b.dismiss("cancel")}}var c=["$scope","$modalInstance","$state","$translate","$filter",b];g.open({templateUrl:"pages/common/keyDlg.html",controller:c,scope:a})},a.uploadFinish=function(b,c){"logoInput"==b?(a.merchantDetail.langData.logo=c.fullName,a.logo=c.fileName):"ImageInput"==b&&(a.merchantDetail.langData.img=c.fullName,a.img=c.fileName),a.$apply()},a.changeTab=function(b){a.form.merchantId&&d(function(){$(".tab"+b).parent().find("a").click()})},a.form.AreaTab&&(a.changeTab(2),a.form.AreaTab=!1),a.showTab=function(b,c){switch(b.preventDefault(),c){case"area":j(),a.showArea=!0,d(function(){$(b.target).tab("show")},10)}};for(var h=0;h<a.form.languageList.length;h++)a.form.languageList[h].select=!1;a.loginMethod=[!1,!1,!0],a.form.merchantId?(a.newMerchant=!1,a.getMerchantDetail()):(a.pageLanguage="",a.defaultLanguage="",a.newMerchant=!0,a.merchantDetail={status:"",isCouponManagement:0,issueStampMethod:"",reservationType:"0",langData:{}},a.getSecurityKey()),a.getCurrencyUnitlist();var i={pageNumber:1,pageSize:30,sort:null};a.gridOptions={paginationPageSize:30,enableVerticalScrollbar:0,enableGridMenu:!1,useExternalPagination:!0,useExternalSorting:!0,enableColumnResizing:!0,enableFullRowSelection:!1,enablePaginationControls:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,noUnselect:!1,rowHeight:48,enableRowSelection:!0,rowTemplate:'<div ios-dblclick="grid.appScope.onDblClick(row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',columnDefs:[{name:"Area info",field:"merchantAreaLangMaps[0].areaInfo",minWidth:70,width:130,enableSorting:!1,enableColumnResizing:!0,headerCellClass:"myTableHeader"},{name:"Created time",field:"createdTime",minWidth:20,width:140,enableSorting:!1,enableColumnResizing:!0,headerCellClass:"myTableHeader"}],onRegisterApi:function(b){a.gridApi=b,a.gridApi.core.on.sortChanged(a,function(b,c){if(0==c.length)a.sortField="id",a.sortType="ASC";else{for(;c.length>1;)c[0].unsort(),c.shift();a.sortField=c[0].field,a.sortType=c[0].sort.direction.toUpperCase()}j()}),b.pagination.on.paginationChanged(a,function(a,b){i.pageNumber=a,i.pageSize=b,j()}),a.onDblClick=function(b){a.form.merchantAreaId=b.entity.id,a.form.storeAreaDetail=b.entity,f.path("/main/storeAreaDetail")},b.pagination.displayPage=function(){var a=[],c=0,d=b.pagination.getTotalPages(),e=5;b.pagination.getTotalPages()>e&&(b.pagination.getPage()>Math.ceil(e/2)?(c=b.pagination.getPage()-Math.ceil(e/2),d=b.pagination.getPage()+Math.floor(e/2),b.pagination.getPage()>b.pagination.getTotalPages()-Math.floor(e/2)&&(c=b.pagination.getTotalPages()-e),d>b.pagination.getTotalPages()&&(d=b.pagination.getTotalPages())):d=e);for(var f=c;f<d;f++)a.push(f+1);return a}}},a.getTableHeight=function(){var b=a.gridOptions.rowHeight;return{height:a.gridOptions.data.length*b+68+"px"}};var j=function(){var b=(i.pageNumber-1)*i.pageSize,c=i.pageSize,d=b+c,e=apiDomain+getmerchantAreaListApi,f=copyData(a.form.userInfo);f.merchantId=a.form.merchantId,$.ajax({type:a.form.postType,url:e,context:document.body,data:f,success:function(c){apiResultsProcessingFun(c,function(){null==c.result&&(c.result=[]),a.gridOptions.totalItems=c.result.length,a.gridOptions.data=c.result,a.gridOptions.startItem=b+1,d>a.gridOptions.totalItems&&(d=a.gridOptions.totalItems),0==a.gridOptions.totalItems&&(a.gridOptions.startItem=0),a.gridOptions.endItem=d,a.gridOptions.data.forEach(function(a,b){}),a.$apply(),$(".ui-grid-row").css("cursor","pointer")})}})};a.deleteArea=function(){function b(a,b,c,d,e){a.showOk=!0,a.msg=e("translate")("AreYouSure"),a.cancel=function(){b.dismiss("cancel")},a.ok=function(){a.deleteUserAction(),b.dismiss("cancel")}}if(0==a.gridApi.selection.getSelectedRows().length)return void a.alert("warning"," ","Please select the data first！");var c=["$scope","$modalInstance","$state","$translate","$filter",b];g.open({templateUrl:"pages/common/warningDlg.html",controller:c,scope:a})},a.deleteUserAction=function(){for(var b=a.gridApi.selection.getSelectedRows(),c=[],d=0;d<b.length;d++)c.push(b[d].id);var e=c.join(","),f=apiDomain+delMerchantAreaApi,g=copyData(a.form.userInfo);g.ids=e,$.ajax({type:a.form.postType,url:f,context:document.body,data:g,success:function(b){apiResultsProcessingFun(b,function(){a.alert("success"," ","Success！"),j(),a.$apply()})}})},a.addStoreArea=function(){a.form.merchantAreaId="",f.path("/main/storeAreaDetail")}}var MerchantDetailCtrl=["$scope","$translate","$state","$timeout","form","$location","$modal",merchantDetailCtrl];angular.module("keeperp").controller("MerchantDetailCtrl",MerchantDetailCtrl);