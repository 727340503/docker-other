function homePageCtrl(a,b,c,d,e,f,g){a.form=e,a.maxData=[5,1,4,1],a.isSave=!1,a.homePageStatus={1:"Pending",2:"Active",3:"Expired",4:"Inactive"},a.typeLabel={1:"Coupon",2:"Banner",3:"Game",4:"Campaign"},a.merchantListEvent=function(){var b=apiDomain+getMerchantListApi,c=copyData(a.form.userInfo);c.startRow=0,c.maxRows=1e6,c.sortType="ASC",c.sortField="id",$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.merchantList=b.resultList,a.$apply()})}})},a.setRecordData=function(){a.data={};for(var b=0;b<a.records.length;b++)a.data[a.records[b].refId+"_"+a.records[b].type]=a.records[b]},a.getMerchantHomePage=function(){var b=apiDomain+getMerchantHomePageApi,c=copyData(a.form.userInfo);c.merchantId=a.form.merchantId,c.status=0,$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.homepage=angular.fromJson(b.result.homePageFrame),a.getMerchantDetail(),a.records=b.result.homePageData,a.homepage?(a.setRecordData(),a.flexsliderLanding(),a.flexsliderCoupon()):(a.homepage=[[],[],[],[]],a.records=[],a.data={}),a.$apply()})}})},a.getMerchantDetail=function(){var b=apiDomain+getMerchantDetailApi,c=copyData(a.form.userInfo);c.merchantId=a.form.merchantId,$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.merchantDetail=b.result,a.$apply()})}})},2==a.form.systemUserRole.roleType?a.getMerchantHomePage():a.merchantListEvent(),a.saveEvent=function(){var b=apiDomain+updateMerchantHomePageApi,c=copyData(a.form.userInfo),d=[];if(0==a.homepage[0].length)return void a.alert("warning"," ","At least 1 banner in the first section.");if(0==a.homepage[2].length)return void a.alert("warning"," ","At least 1 banner in the last section. ");for(var e=0;e<a.homepage.length;e++)for(var f=0;f<a.homepage[e].length;f++)d.push({refId:a.homepage[e][f].refId,type:a.homepage[e][f].type});c.merchantId=a.form.merchantId,c.homePageFrame=angular.toJson(a.homepage),c.homePageData=angular.toJson(d),$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.alert("success"," ","Success！"),a.isSave=!0,a.getMerchantHomePage(),a.$apply()})}})},a.publishEvent=function(){if(a.isSave){var b=apiDomain+publishMerchantHomePageApi,c=copyData(a.form.userInfo);c.merchantId=a.form.merchantId,$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.alert("success"," ","Success！"),a.isSave=!1,a.getMerchantHomePage(),a.$apply()})}})}},a.goPreview=function(){f.path("/main/homePagePreview")},a.currentEvent=function(){f.path("/main/homePageCurrent")},a.statusClass={1:"warning",2:"success",3:"info",4:"danger"},a.sortableOptions0={connectWith:".connectList0"},a.sortableOptions1={connectWith:".connectList1"},a.sortableOptions2={connectWith:".connectList2"},a.sortableOptions3={connectWith:".connectList3"},a.flexsliderLanding=function(){$(".flexsliderLand").remove();for(var b='<div class="flexsliderLand flexslider"><ul class="slides">',c=0;c<a.homepage[0].length;c++)a.data[a.homepage[0][c].refId+"_"+a.homepage[0][c].type]&&(b+='<li><img src="'+a.data[a.homepage[0][c].refId+"_"+a.homepage[0][c].type].img+'"></li>');b+="</ul></div>",$(".landing").append(b),$(".flexsliderLand").flexslider({animation:"slide",directionNav:!1,slideshow:!1,slideshowSpeed:1e3,prevText:"",nextText:"",controlNav:!0})},a.flexsliderCoupon=function(){$(".flexsliderCoupon").remove();for(var b='<div class="flexsliderCoupon flexslider"><ul class="slides">',c=0;c<a.homepage[2].length;c++)a.data[a.homepage[2][c].refId+"_"+a.homepage[2][c].type]&&(b+='<li ><img src="'+a.data[a.homepage[2][c].refId+"_"+a.homepage[2][c].type].img+'"></li>');b+="</ul></div>",$(".coupon").append(b),$(".flexsliderCoupon").flexslider({animation:"slide",directionNav:!1,slideshow:!1,slideshowSpeed:1e3,prevText:"",nextText:"",controlNav:!0})},a.$watch("homepage",function(b,c){b!=c&&(a.flexsliderLanding(),a.flexsliderCoupon())},!0),a.delete=function(b,c){a.homepage[b].splice(c,1)},a.selectUrl=function(a){switch(a){case 1:url=getHomePageCouponListApi;break;case 2:url=getHomePageBanerListApi;break;case 3:url=getMerchantGameListApi;break;case 4:url=getMerchantCampaignListApi}return url},a.addLandingCart=function(b){if(a.homepage[0].length<a.maxData[0]){var c=a.selectUrl(b);a.chose(c,0,b)}},a.addPromotionCart=function(b){if(a.homepage[3].length<a.maxData[3]){var c=a.selectUrl(b);a.chose(c,3,b)}},a.addCouponCart=function(b){if(a.homepage[2].length<a.maxData[2]){var c=a.selectUrl(b);a.chose(c,2,b)}},a.addGameCart=function(b){if(a.homepage[1].length<a.maxData[1]){var c=a.selectUrl(b);a.chose(c,1,b)}},a.chose=function(b,c,d){function e(a,e,f,g,h){a.showOk=!0,a.opened=!1,a.msg=h("translate")("AreYouSure"),a.statusArr={1:"Pending",2:"Active",3:"Expired",4:"Inactive"},a.select=function(b){a.refId=b.id,a.status=b.status,a.img=b.img,a.name=b.name},a.cancel=function(){e.dismiss("cancel")},a.ok=function(){a.refId?(a.homepage[c].push({refId:a.refId,type:d}),a.data[a.refId+"_"+d]||(a.data[a.refId+"_"+d]={refId:a.refId,type:d,status:a.status,img:a.img,name:a.name},a.records.push({refId:a.refId,type:d})),a.isSave=!1,e.dismiss("cancel")):a.alert("warning"," ","Please select the data first！")},a.readyEvent=function(){if(!a.opened){$(".inmodal").parent().parent().width(1e3),a.opened=!0;(function(){var c=apiDomain+b,e=copyData(a.form.userInfo);e.merchantId=a.form.merchantId,$.ajax({type:a.form.postType,url:c,context:document.body,data:e,success:function(b){apiResultsProcessingFun(b,function(){var c=b.result;a.dataList=[];for(var e=0;e<c.length;e++)4!=d||1!=c[e].status&&2!=c[e].status?4!=d&&2==c[e].status&&a.dataList.push(c[e]):a.dataList.push(c[e]);a.$apply()})}})})()}}}var f=["$scope","$modalInstance","$state","$translate","$filter",e];g.open({templateUrl:"pages/common/selectDlg.html",controller:f,scope:a})},$(window).on("resize",function(){$(".homePage .landing").height($(".homePage .landing img").height()),$(".homePage .coupon").height($(".homePage .coupon img").height())})}var HomePageCtrl=["$scope","$translate","$state","$timeout","form","$location","$modal",homePageCtrl];angular.module("keeperp").controller("HomePageCtrl",HomePageCtrl);