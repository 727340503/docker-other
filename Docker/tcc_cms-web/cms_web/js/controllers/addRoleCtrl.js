function addRoleCtrl(a,b,c,d,e,f,g,h){function i(){j=$("#jstree1").jstree("get_checked")}a.form.firtstFunctionList=[],a.form.secondFuntionList=[];var j,k="";a.getSystemRoleFunctionList=function(){var b=apiDomain+getSystemFuncAllListApi,c=copyData(a.form.userInfo);c.startRecord=0,c.maxRecords=1e6,c.sortType="ASC",c.sortField="createdTime",$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.functionList=b.result;for(var c=0;c<a.functionList.length;c++)0==a.functionList[c].parentId&&a.form.firtstFunctionList.push({id:a.functionList[c].id,text:a.functionList[c].funcName,a_attr:{class:"jstree-clicked"},children:[]});for(var c=0;c<a.form.firtstFunctionList.length;c++)for(var d=0;d<a.functionList.length;d++)if(a.form.firtstFunctionList[c].id==a.functionList[d].parentId){var e={id:a.functionList[d].id,text:a.functionList[d].funcName,children:[]};a.form.firtstFunctionList[c].children.push(e);for(var f=0;f<a.functionList.length;f++)a.functionList[f].parentId==a.functionList[d].id&&e.children.push({id:a.functionList[f].id,text:a.functionList[f].funcName,children:[]})}var g=a.form.firtstFunctionList;$("#jstree1").jstree({plugins:["checkbox","types","themes","state","html_data"],types:{default:{icon:!1}},core:{multiple:!0,data:g,dblclick_toggle:!1}}),$("#jstree1").bind("activate_node.jstree",function(a,b){i()}),a.$apply()})}})},a.checkParent=function(b){for(var c=0;c<b.length;c++)for(var d=0;d<a.functionList.length;d++)if(b[c]==a.functionList[d].id&&0!=a.functionList[d].parentId){for(var e=!0,f=0;f<b.length;f++)a.functionList[d].parentId==b[f]&&(e=!1);e&&b.push(a.functionList[d].parentId)}return b},a.save=function(){j=a.checkParent(j),k=j.join(",");var b=apiDomain+createSystemRoleApi,c=copyData(a.form.userInfo);c.roleName=a.roleName,c.roleDesc=a.description,c.roleType=a.roleType,c.funcIds=k,$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.alert("success"," ","Success！"),a.$apply()})}})},jQuery.validator.addMethod("checkSpace",function(a,b,c){return 0!=a.replace(/\s/g,"").length},$.validator.format("不能为空字符")),$("#baseInfo").validate({errorPlacement:function(a,b){b.parent().after(a)},rules:{},messages:{},submitHandler:function(b){a.save()}}),a.cancel=function(){e.path("/main/roleList")},a.init=function(){a.getSystemRoleFunctionList()},a.roleType="",a.init()}var AddRoleCtrl=["$scope","$translate","$http","form","$location","uiGridConstants","$filter","i18nService",addRoleCtrl];angular.module("keeperp").controller("AddRoleCtrl",AddRoleCtrl);