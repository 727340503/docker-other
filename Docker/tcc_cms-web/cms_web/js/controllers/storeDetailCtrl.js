function storeDetailCtrl(a,b,c,d,e,f,g){a.form=e,a.cancel=function(){f.path("/main/storeList")},$("#baseInfo").validate({errorPlacement:function(a,b){b.parent().after(a)},rules:{},messages:{},submitHandler:function(b){a.newStore?a.createStore():a.updateStore()}}),a.getStoreDetail=function(){var b=apiDomain+getStoreDetailApi,c=copyData(a.form.userInfo);c.storeId=a.form.storeId,$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.storeDetail=b.result,a.storeDetail.merchantId+="",a.storeDetail.merchantAreaId+="",a.storeDetail.status+="",a.storeDetail.langData=a.storeDetail.storeLangMaps[0],a.image=a.storeDetail.langData.image,a.storeDetail.langData.image=a.storeDetail.langData.fullImage,a.pageLanguage=a.storeDetail.langData.langCode,1==a.form.systemUserRole.roleType?a.merchantListEvent():(a.storeDetail.merchantId=a.form.merchantId,a.getMerchantDetail(a.form.merchantId)),a.getStoreArea(),a.$apply()})}})},a.updateStore=function(){var b=apiDomain+updateStoreApi,c=copyData(a.form.userInfo);c.storeId=a.form.storeId,c.status=a.storeDetail.status,c.phone=a.storeDetail.phone,c.externalStoreId=a.storeDetail.externalStoreId,c.merchantAreaId=a.storeDetail.merchantAreaId,c.langData=[{id:a.storeDetail.langData.id,image:a.image,name:a.storeDetail.langData.name,address:a.storeDetail.langData.address,businessInfo:a.storeDetail.langData.businessInfo}],c.langData=angular.toJson(c.langData),c.lat=a.storeDetail.lat,c.lng=a.storeDetail.lng,$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.alert("success"," ","Success！"),a.getStoreDetail()})}})},a.createStore=function(){var b=apiDomain+createStoreApi,c=copyData(a.form.userInfo);c.merchantId=a.storeDetail.merchantId,c.phone=a.storeDetail.phone,c.externalStoreId=a.storeDetail.externalStoreId,a.storeDetail.langData.image=a.image,c.merchantAreaId=a.storeDetail.merchantAreaId,c.lat=a.storeDetail.lat,c.lng=a.storeDetail.lng,c.langData=[],c.langData.push(a.storeDetail.langData),c.langData=angular.toJson(c.langData),$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.alert("success"," ","Success！"),d(function(){f.path("/main/storeList")})})}})},a.merchantListEvent=function(){var b=apiDomain+getMerchantListApi,c=copyData(a.form.userInfo);c.startRow=0,c.maxRows=1e6,c.sortType="ASC",c.sortField="id",$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.merchantList=b.resultList,a.storeDetail.merchantId||(a.storeDetail.merchantId=a.merchantList[0].id+""),a.getMerchantDetail(a.storeDetail.merchantId),a.$apply()})}})},a.getMerchantDetail=function(b){var c=apiDomain+getMerchantDetailApi,d=copyData(a.form.userInfo);d.merchantId=b,$.ajax({type:a.form.postType,url:c,context:document.body,data:d,success:function(b){apiResultsProcessingFun(b,function(){for(var c=0;c<a.form.languageList.length;c++)a.form.languageList[c].select=!1;a.merchantDetail=b.result;for(var c=0;c<a.merchantDetail.merchantLangMapList.length;c++)a.merchantDetail.merchantLangMapList[c].isDefault&&(a.storeDetail.langData.langCode=a.merchantDetail.merchantLangMapList[c].langCode);a.mapType=a.merchantDetail.mapType,a.getStoreArea(),a.mapEvent(),a.$apply()})}})},a.getStoreArea=function(){var b=apiDomain+getmerchantAreaListApi,c=copyData(a.form.userInfo);c.merchantId=a.storeDetail.merchantId,$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){if(a.areaList=b.result,a.areaList)for(var c=0;c<a.areaList.length;c++)for(var d=0;d<a.areaList[c].merchantAreaLangMaps.length;d++)a.areaList[c].merchantAreaLangMaps[d].langCode==a.storeDetail.langData.langCode&&(a.areaList[c].areaInfo=a.areaList[c].merchantAreaLangMaps[d].areaInfo);a.$apply()})}})},a.selectPageLang=function(){d(function(){for(var b=0;b<a.storeDetail.storeLangMaps.length;b++)a.storeDetail.storeLangMaps[b].langCode==a.pageLanguage&&(a.storeDetail.langData=a.storeDetail.storeLangMaps[b],a.image=a.storeDetail.langData.image,a.storeDetail.langData.image=a.storeDetail.langData.fullImage);for(var b=0;b<a.areaList.length;b++)for(var c=0;c<a.areaList[b].merchantAreaLangMaps.length;c++)a.areaList[b].merchantAreaLangMaps[c].langCode==a.pageLanguage&&(a.areaList[b].areaInfo=a.areaList[b].merchantAreaLangMaps[c].areaInfo)})},a.uploadFinish=function(b,c){a.storeDetail.langData.image=c.fullName,a.image=c.fileName,a.$apply()},a.mapType=0,a.mapEvent=function(){d(function(){if(1==a.mapType){var b=document.createElement("script");b.src="https://api.map.baidu.com/api?v=2.0&ak="+baiduMapKey+"&s=1&callback=baiduInitialize",document.body.appendChild(b)}else if(a.haveGoogleMap)a.$root.googleMapEvent();else{var b=document.createElement("script");b.src="https://maps.googleapis.com/maps/api/js?key="+googleMapKey+"&libraries=places&callback=googleInitialize",document.body.appendChild(b)}})},a.form.storeId?(a.newStore=!1,a.getStoreDetail()):(a.newStore=!0,a.storeDetail={langData:{},lat:""},1==a.form.systemUserRole.roleType?a.merchantListEvent():(a.storeDetail.merchantId=a.form.merchantId,a.getMerchantDetail(a.form.merchantId))),a.$root.baiduMapEvent=function(){function b(a){return document.getElementById(a)}function c(){function b(){var b=c.getResults().getPoi(0).point;a.storeDetail.lat=b.lat,a.storeDetail.lng=b.lng,e.centerAndZoom(b,15),d=new BMap.Marker(b),e.addOverlay(d)}e.clearOverlays();var c=new BMap.LocalSearch(e,{onSearchComplete:b});c.search(h)}var d,e=new BMap.Map("l-map");if(a.storeDetail.lat){var f=new BMap.Point(a.storeDetail.lng,a.storeDetail.lat);e.clearOverlays(),e.centerAndZoom(f,15),d=new BMap.Marker(f),e.addOverlay(d)}else{var f;(new BMap.Geolocation).getCurrentPosition(function(b){this.getStatus()==BMAP_STATUS_SUCCESS&&(f=new BMap.Point(b.point.lng,b.point.lat),a.storeDetail.lat=b.point.lat,a.storeDetail.lng=b.point.lng,e.centerAndZoom(f,15),d=new BMap.Marker(f),e.addOverlay(d))},{enableHighAccuracy:!0})}e.enableScrollWheelZoom();var g=new BMap.Autocomplete({input:"businessAdr",location:e});a.ac=g,g.addEventListener("onhighlight",function(a){var c="",d=a.fromitem.value,e="";a.fromitem.index>-1&&(e=d.province+d.city+d.district+d.street+d.business),c="FromItem<br />index = "+a.fromitem.index+"<br />value = "+e,e="",a.toitem.index>-1&&(d=a.toitem.value,e=d.province+d.city+d.district+d.street+d.business),c+="<br />ToItem<br />index = "+a.toitem.index+"<br />value = "+e,b("searchResultPanel").innerHTML=c});var h;g.addEventListener("onconfirm",function(d){var e=d.item.value;h=e.province+e.city+e.district+e.street+e.business,b("searchResultPanel").innerHTML="onconfirm<br />index = "+d.item.index+"<br />myValue = "+h,a.storeDetail.langData.address=h,a.$apply(),c()}),e.addEventListener("click",function(b){var c=new BMap.Point(b.point.lng,b.point.lat);a.storeDetail.lat=b.point.lat,a.storeDetail.lng=b.point.lng,e.clearOverlays(),d=new BMap.Marker(c),e.addOverlay(d)}),a.ac.setInputValue(a.storeDetail.langData.address)};var h,i,j,k,l;a.$root.googleMapEvent=function(){a.haveGoogleMap=!0,a.storeDetail.lat?(k=parseFloat(a.storeDetail.lat),l=parseFloat(a.storeDetail.lng),a.setGoogle()):(k=22.322409,l=114.182154,a.storeDetail.lat=k,a.storeDetail.lng=l,a.setGoogle())},a.setGoogle=function(){h=document.getElementById("businessAdr"),i=new google.maps.Map(document.getElementById("l-map"),{center:{lat:k,lng:l},zoom:13,mapTypeId:"roadmap"}),j=new google.maps.Marker({position:{lat:k,lng:l},map:i});var b=new google.maps.places.SearchBox(h);i.controls[google.maps.ControlPosition.TOP_LEFT].push(h),i.addListener("bounds_changed",function(){b.setBounds(i.getBounds())}),i.addListener("click",function(b){j.setMap(null),a.storeDetail.lat=b.latLng.lat(),a.storeDetail.lng=b.latLng.lng(),j=new google.maps.Marker({position:b.latLng,map:i})});var c=[];b.addListener("places_changed",function(d){var e=b.getPlaces();if(j.setMap(null),0!=e.length){c.forEach(function(a){a.setMap(null)}),c=[];var f=new google.maps.LatLngBounds;e.forEach(function(b){if(b.geometry){b.icon,new google.maps.Size(71,71),new google.maps.Point(0,0),new google.maps.Point(17,34),new google.maps.Size(25,25);j=new google.maps.Marker({map:i,position:b.geometry.location}),a.storeDetail.lat=b.geometry.location.lat(),a.storeDetail.lng=b.geometry.location.lng(),b.geometry.viewport?f.union(b.geometry.viewport):f.extend(b.geometry.location)}}),i.fitBounds(f)}})}}function baiduInitialize(){angular.element("body").scope().$root.baiduMapEvent()}function googleInitialize(){angular.element("body").scope().$root.googleMapEvent()}var StoreDetailCtrl=["$scope","$translate","$state","$timeout","form","$location","$modal",storeDetailCtrl];angular.module("keeperp").controller("StoreDetailCtrl",StoreDetailCtrl);