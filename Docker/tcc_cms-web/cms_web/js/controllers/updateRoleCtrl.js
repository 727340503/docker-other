function updateRoleCtrl(a,b,c,d,e,f,g,h){function i(){j=$("#jstree1").jstree("get_checked")}a.form=d,a.form.firtstFunctionList=[],a.form.secondFuntionList=[];var j=[],k="";a.getSystemRoleFunctionList=function(){var b=apiDomain+getSystemFuncAllListApi,c=copyData(a.form.userInfo);c.startRecord=0,c.maxRecords=1e6,c.sortType="ASC",c.sortField="createdTime",$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.functionList=b.result;for(var c=0;c<a.functionList.length;c++)0==a.functionList[c].parentId&&a.form.firtstFunctionList.push({id:"func_"+a.functionList[c].id,parentId:0,text:a.functionList[c].funcName,children:[]});for(var c=0;c<a.form.firtstFunctionList.length;c++)for(var d=0;d<a.functionList.length;d++)if(a.form.firtstFunctionList[c].id=="func_"+a.functionList[d].parentId){var e={id:"func_"+a.functionList[d].id,text:a.functionList[d].funcName,children:[]};a.form.firtstFunctionList[c].children.push(e);for(var f=0;f<a.functionList.length;f++)a.functionList[d].id==a.functionList[f].parentId&&e.children.push({id:"func_"+a.functionList[f].id,text:a.functionList[f].funcName,children:[]})}for(var c=0;c<a.functionList.length;c++)for(var d=0;d<a.form.firtstFunctionList.length;d++)for(var f=0;f<a.form.firtstFunctionList[d].children.length;f++)for(var g=0;g<a.form.firtstFunctionList[d].children[f].children.length;g++)"func_"+a.functionList[c].parentId==a.form.firtstFunctionList[d].children[f].children[g].id&&a.form.firtstFunctionList[d].children[f].children[g].children.push({id:"func_"+a.functionList[c].id,text:a.functionList[c].funcName,children:[]});for(var c=0;c<a.functionList.length;c++)for(var d=0;d<a.form.firtstFunctionList.length;d++)for(var f=0;f<a.form.firtstFunctionList[d].children.length;f++)for(var g=0;g<a.form.firtstFunctionList[d].children[f].children.length;g++)for(var h=0;h<a.form.firtstFunctionList[d].children[f].children[g].children.length;h++)"func_"+a.functionList[c].parentId==a.form.firtstFunctionList[d].children[f].children[g].children[h].id&&a.form.firtstFunctionList[d].children[f].children[g].children[h].children.push({id:"func_"+a.functionList[c].id,text:a.functionList[c].funcName,children:[]});var k=a.form.firtstFunctionList;$("#jstree1").jstree({plugins:["checkbox","types","themes","state"],types:{default:{icon:!1}},core:{multiple:!0,data:k,dblclick_toggle:!1},plugins:["checkbox"]}).on("ready.jstree",function(){for(var b=0;b<a.functionList.length;b++)for(var c=0;c<a.roledetail.systemFuncs.length;c++)a.functionList[b].parentId==a.roledetail.systemFuncs[c]&&a.roledetail.systemFuncs.splice(c,1);for(var b=0;b<a.roledetail.systemFuncs.length;b++){j.push("func_"+a.roledetail.systemFuncs[b]);var d=a.roledetail.systemFuncs[b];$("#jstree1").jstree("select_node","#func_"+d)}});$("#jstree1").bind("activate_node.jstree",function(a,b){i()}),a.$apply()})}})},a.checkParent=function(b){for(var c=0;c<b.length;c++)for(var d=0;d<a.functionList.length;d++)if(b[c]==a.functionList[d].id&&0!=a.functionList[d].parentId){for(var e=!0,f=0;f<b.length;f++)a.functionList[d].parentId==b[f]&&(e=!1);e&&b.push(a.functionList[d].parentId)}return b},a.save=function(){for(var b=0;b<j.length;b++)j[b]=j[b].replace(/func_/,"");j=a.checkParent(j),k=j.join(",");var c=apiDomain+updateSystemRoleApi,d=copyData(a.form.userInfo);d.roleId=a.form.roleId,d.roleName=a.roledetail.roleName,d.roleDesc=a.roledetail.roleDesc,d.roleType=a.roledetail.roleType,d.funcIds=k,$.ajax({type:a.form.postType,url:c,context:document.body,data:d,success:function(b){apiResultsProcessingFun(b,function(){a.alert("success"," ","Success！"),a.$apply()})}})},a.getSystemRoleDetail=function(){var b=apiDomain+getSystemRoleDetailApi,c=copyData(a.form.userInfo);c.roleId=a.form.roleId,$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.roledetail=b.result,a.roledetail.roleType+="",a.getSystemRoleFunctionList(),a.$apply()})}})},jQuery.validator.addMethod("checkSpace",function(a,b,c){return 0!=a.replace(/\s/g,"").length},$.validator.format("不能为空字符")),$("#baseInfo").validate({errorPlacement:function(a,b){b.parent().after(a)},rules:{},messages:{},submitHandler:function(b){a.save()}}),a.cancel=function(){e.path("/main/roleList")},a.init=function(){a.getSystemRoleDetail()},a.init()}var UpdateRoleCtrl=["$scope","$translate","$http","form","$location","uiGridConstants","$filter","i18nService",updateRoleCtrl];angular.module("keeperp").controller("UpdateRoleCtrl",UpdateRoleCtrl);