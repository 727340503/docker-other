function rewardRuleDetailCtrl(a,b,c,d,e,f,g){a.form=e,a.form.rewardTab=!0,a.cancel=function(){f.path("/main/campaignDetail")},$("#baseInfo").validate({errorPlacement:function(a,b){b.parent().after(a)},rules:{},messages:{},submitHandler:function(b){a.submitEvent()}}),a.updateRewardRule=function(){var b=apiDomain+udpateCampaignGiftApi,c=copyData(a.form.userInfo);c.campaignId=a.form.campaignId,c.campaignGiftMapId=a.rewardRuleDetail.id,c.externalGiftId=a.rewardRuleDetail.externalGiftId,c.status=a.rewardRuleDetail.status,c.isReservation=a.rewardRuleDetail.isReservation;for(var d=0;d<a.rewardRuleDetail.giftExchangeTypeData.length;d++)a.rewardRuleDetail.giftExchangeTypeData[d].externalRuleCode=$.trim(a.rewardRuleDetail.giftExchangeTypeData[d].externalRuleCode);c.giftExchangeTypeData=angular.toJson(a.rewardRuleDetail.giftExchangeTypeData),$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.alert("success"," ","Success！"),a.getRewardRuleDetail()})}})},a.getRewardRuleDetail=function(){var b=apiDomain+getCampaignGiftMapDetailApi,c=copyData(a.form.userInfo);c.campaignId=a.form.campaignId,c.giftId=a.form.giftId,$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.rewardRuleDetail=b.result,a.rewardRuleDetail.status+="",a.rewardRuleDetail.giftExchangeTypeData=b.result.giftExchangeTypes,a.watchData(),a.$apply()})}})},a.watchData=function(){for(var b=0;b<a.rewardRuleDetail.giftExchangeTypeData.length;b++)a.$watch("rewardRuleDetail.giftExchangeTypeData["+b+"].stampQty",function(b,c){for(var d=new RegExp("^[0-9]*$"),e=0;e<a.rewardRuleDetail.giftExchangeTypeData.length;e++){var f=a.rewardRuleDetail.giftExchangeTypeData[e].stampQty+"";d.test(f)||(a.rewardRuleDetail.giftExchangeTypeData[e].stampQty=f.substring(0,f.length-1)),""!=f&&f||(a.rewardRuleDetail.giftExchangeTypeData[e].stampQty="")}},!0),a.$watch("rewardRuleDetail.giftExchangeTypeData["+b+"].cashQty",function(b,c){for(var d=new RegExp("^[0-9]*$"),e=0;e<a.rewardRuleDetail.giftExchangeTypeData.length;e++){var f=a.rewardRuleDetail.giftExchangeTypeData[e].cashQty+"";d.test(f)||(a.rewardRuleDetail.giftExchangeTypeData[e].cashQty=f.substring(0,f.length-1)),""!=f&&f||(a.rewardRuleDetail.giftExchangeTypeData[e].cashQty="")}},!0)},a.addRewardRule=function(){var b=apiDomain+addCampaignGiftApi,c=copyData(a.form.userInfo);c.campaignId=a.form.campaignId,c.giftId=a.form.giftId,c.externalGiftId=a.rewardRuleDetail.externalGiftId,c.isReservation=a.rewardRuleDetail.isReservation;for(var e=0;e<a.rewardRuleDetail.giftExchangeTypeData.length;e++)a.rewardRuleDetail.giftExchangeTypeData[e].externalRuleCode=$.trim(a.rewardRuleDetail.giftExchangeTypeData[e].externalRuleCode);c.giftExchangeTypeData=angular.toJson(a.rewardRuleDetail.giftExchangeTypeData),$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.alert("success"," ","Success！"),d(function(){f.path("/main/campaignDetail")})})}})},a.delRewardRule=function(b){if(a.rewardRuleDetail.giftExchangeTypeData[b].id){var c=apiDomain+delCampaignGiftMapEXTypeApi,d=copyData(a.form.userInfo);d.ids=a.rewardRuleDetail.giftExchangeTypeData[b].id,$.ajax({type:a.form.postType,url:c,context:document.body,data:d,success:function(b){apiResultsProcessingFun(b,function(){a.getRewardRuleDetail()})}})}else a.rewardRuleDetail.giftExchangeTypeData.splice(b,1)},a.checkCash=function(b){"1"==a.rewardRuleDetail.giftExchangeTypeData[b].type?a.rewardRuleDetail.giftExchangeTypeData[b].type=2:a.rewardRuleDetail.giftExchangeTypeData[b].type=1},a.checkStatus=function(b){"1"==a.rewardRuleDetail.giftExchangeTypeData[b].status?a.rewardRuleDetail.giftExchangeTypeData[b].status="0":a.rewardRuleDetail.giftExchangeTypeData[b].status="1"},a.addRule=function(){a.rewardRuleDetail.giftExchangeTypeData.push({stampQty:"",type:2,cashQty:"",externalRuleCode:"",status:"1"}),a.watchData()},a.submitEvent=function(){a.form.newGift?a.addRewardRule():a.updateRewardRule()},a.checkReservation=function(){"1"==a.rewardRuleDetail.isReservation?a.rewardRuleDetail.isReservation="0":a.rewardRuleDetail.isReservation="1"},a.getGiftList=function(){var b=apiDomain+getGiftListApi,c=copyData(a.form.userInfo);c.campaignId=a.form.campaignId,c.startRow=0,c.maxRows=1e6,c.sortType="ASC",c.sortField="id",c.merchantId=a.form.merchantId,a.form.newGift?c.isRelatedCampaign=!1:c.isRelatedCampaign=!0,$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.giftList=b.resultList,a.$apply()})}})},a.form.newGift?(a.rewardRuleDetail={isReservation:"0",status:"2",giftExchangeTypeData:[{stampQty:"",type:1,cashQty:"",externalRuleCode:"",status:"1"}]},a.watchData()):(a.form.giftId+="",a.getRewardRuleDetail()),a.getGiftList()}var RewardRuleDetailCtrl=["$scope","$translate","$state","$timeout","form","$location","$modal",rewardRuleDetailCtrl];angular.module("keeperp").controller("RewardRuleDetailCtrl",RewardRuleDetailCtrl);