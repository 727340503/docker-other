function reservationDetailCtrl(a,b,c,d,e,f,g,h){a.form=e,a.cancel=function(){g.path("/main/reservationList")},a.mappingStatus=function(a){var b="";switch(a){case 1:b=f("translate")("Confirmed");break;case 2:b=f("translate")("Available at store");break;case 3:b=f("translate")("Settled");break;case 4:b=f("translate")("Expired");break;case 5:b=f("translate")("Incompleted");break;case 6:b=f("translate")("Cancelled");break;default:b=a}return b},a.getUserReservationDetail=function(){var b=apiDomain+getUserReservationDetailApi,c=copyData(a.form.userInfo);c.userReservationId=a.form.userReservationId,$.ajax({type:a.form.postType,url:b,context:document.body,data:c,success:function(b){apiResultsProcessingFun(b,function(){a.reservationDetail=b.result,a.reservationDetail.status=a.mappingStatus(a.reservationDetail.status),a.reservationDetail.rule="Stamp Qty: "+a.reservationDetail.stampQty,a.reservationDetail.cashQty&&(a.reservationDetail.rule+=" + Cash Qty: "+a.reservationDetail.cashQty),a.reservationDetail.contactPhone&&(a.reservationDetail.contactPhone=a.form.phoneCodeFormat(a.reservationDetail.contactPhoneAreaCode)+" - "+a.reservationDetail.contactPhone),a.reservationDetail.storeNameLong=a.reservationDetail.storeName+" ("+a.reservationDetail.storeAddress+")",a.$apply()})}})},a.getUserReservationDetail(),a.AvailableAtStoreDB=function(b){function c(a,c,d,e,f){a.showOk=!0,a.msg="When status set as available at store, system send in-app notification to user automatically",a.cancel=function(){c.dismiss("cancel")},a.ok=function(){a.changeStatus(b),a.form.closeDlg2(),c.dismiss("cancel")}}var d=["$scope","$modalInstance","$state","$translate","$filter",c];h.open({templateUrl:"pages/common/warningDlg.html",controller:d,scope:a})},a.AvailableAtStore=function(b,c,d){function e(a,b,c,d,e){a.showOk=!0,a.opened=!1,a.msg=e("translate")("AreYouSure"),a.cancel=function(){b.dismiss("cancel")},a.ok=function(){$("#time").submit()},a.form.closeDlg2=function(){b.dismiss("cancel")},a.readyEvent=function(){a.opened||($(".inmodal").parent().parent().width(1e3),a.opened=!0,a.selectedData=[],a.selectedData.push(a.reservationDetail),$("#time").validate({errorPlacement:function(a,b){b.parent().after(a)},rules:{},messages:{},submitHandler:function(b){a.AvailableAtStoreDB(a.reservationExpiredTime)}}))}}var f=["$scope","$modalInstance","$state","$translate","$filter",e];h.open({templateUrl:"pages/common/reservationDlg.html",controller:f,scope:a})},a.changeStatus=function(b){var c=apiDomain+updateUserReservationStatusApi,e=copyData(a.form.userInfo);e.status=2,e.ids=a.reservationDetail.id,e.reservationExpiredTime=b,e.merchantId=a.form.merchantId,$.ajax({type:a.form.postType,url:c,context:document.body,data:e,success:function(b){apiResultsProcessingFun(b,function(){a.alert("success"," ","SuccessÔºÅ"),d(function(){g.path("/main/reservationList")})})}})}}var ReservationDetailCtrl=["$scope","$translate","$state","$timeout","form","$filter","$location","$modal",reservationDetailCtrl];angular.module("keeperp").controller("ReservationDetailCtrl",ReservationDetailCtrl);